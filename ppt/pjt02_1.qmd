---
format: 
  revealjs:
    theme: simple
    slide-number: true
    transition: fade
    echo: true
    execute: true
    code-tools: true   # âœ… ì´ê±¸ ì¨ì¤˜ì•¼ ì ‘ê¸° ë²„íŠ¼ ìƒê¹€
    code-fold: true     # ì ‘ì„ ìˆ˜ ìˆëŠ” ë²„íŠ¼ í™œì„±í™”
    css: style.css
    scrollable: true
---

# ì°½ì—…ì„ í•˜ê³ ì‹¶ì€ë°...

# **ë­˜ íŒ”ì£ ?**

------------------------------------------------------------------------

![](./asset/final_img.png){fig-align="center" width="500" height="700"}

------------------------------------------------------------------------

## ì˜¨ë¼ì¸ ì‡¼í•‘ ì»¨ì„¤íŒ… í”„ë¡œì íŠ¸!!

-   **ì°½ì—…? ë¬´ì—‡ì„ íŒ” ì§€ê°€ ë¬¸ì œì–ì•„ìš”?**

-   **ê·¸ë˜ì„œ ì €í¬ê°€ ëŒ€ì‹  ë¶„ì„í–ˆìŠµë‹ˆë‹¤!**


```{python}
#| echo: false
import pandas as pd
from scipy.stats import shapiro, ttest_ind, wilcoxon, chi2_contingency, ttest_rel, f_oneway
import seaborn as sns
import matplotlib.pyplot as plt
import statsmodels.formula.api as smf
import plotly.express as px
import plotly.graph_objects as go
import plotly.colors as pc


plt.rcParams['font.family'] ='Malgun Gothic'
plt.rcParams['axes.unicode_minus'] =False

df = pd.read_csv('../data/onlineshopping.csv')
df.head()

value_columns = [col for col in df.columns if col.startswith('M') and len(col) >= 7]

# ê¸´ í˜•ì‹ìœ¼ë¡œ melt
df_long = pd.melt(
    df,
    id_vars=['A ìƒí’ˆêµ°ë³„(1)', 'A ìƒí’ˆêµ°ë³„(2)', 'B íŒë§¤ë§¤ì²´ë³„(1)'],
    value_vars=value_columns,
    var_name='ì—°ì›”',
    value_name='ê±°ë˜ì•¡(ë°±ë§Œì›)'
)

# ê±°ë˜ì•¡ ìˆ«ìí˜• ë³€í™˜
df_long['ê±°ë˜ì•¡(ë°±ë§Œì›)'] = pd.to_numeric(df_long['ê±°ë˜ì•¡(ë°±ë§Œì›)'], errors='coerce')

media_map = {
    '10 ëª¨ë°”ì¼ì‡¼í•‘': 'Mobile',
    '20 ì¸í„°ë„·ì‡¼í•‘': 'Internet'
}

category_map = {
    '000 í•©ê³„': 'Total',
    '001 ì»´í“¨í„° ë° ì£¼ë³€ê¸°ê¸°': 'Computer',
    '002 ê°€ì „Â·ì „ìÂ·í†µì‹ ê¸°ê¸°': 'Electronics',
    '003 ì„œì ': 'Books',
    '004 ì‚¬ë¬´Â·ë¬¸êµ¬': 'Office Supplies',
    '005 ì˜ë³µ': 'Clothing',
    '006 ì‹ ë°œ': 'Shoes',
    '007 ê°€ë°©': 'Bags',
    '008 íŒ¨ì…˜ìš©í’ˆ ë° ì•¡ì„¸ì„œë¦¬': 'Fashion Accessories',
    '009 ìŠ¤í¬ì¸ Â·ë ˆì €ìš©í’ˆ': 'Sports & Leisure',
    '010 í™”ì¥í’ˆ': 'Cosmetics',
    '011 ì•„ë™Â·ìœ ì•„ìš©í’ˆ': 'Kids & Baby',
    '012 ìŒÂ·ì‹ë£Œí’ˆ': 'Food & Beverages',
    '013 ë†ì¶•ìˆ˜ì‚°ë¬¼': 'Agricultural Products',
    '014 ìƒí™œìš©í’ˆ': 'Household Goods',
    '015 ìë™ì°¨ ë° ìë™ì°¨ìš©í’ˆ': 'Automobiles',
    '016 ê°€êµ¬': 'Furniture',
    '017 ì• ì™„ìš©í’ˆ': 'Pet Supplies',
    '018 ì—¬í–‰ ë° êµí†µì„œë¹„ìŠ¤': 'Travel & Transport',
    '019 ë¬¸í™” ë° ë ˆì €ì„œë¹„ìŠ¤': 'Culture & Leisure',
    '020 ì´ì¿ í°ì„œë¹„ìŠ¤': 'E-Coupon Service',
    '021 ìŒì‹ì„œë¹„ìŠ¤': 'Food Service',
    '022 ê¸°íƒ€ì„œë¹„ìŠ¤': 'Other Services',
    '023 ê¸°íƒ€': 'Others'
}

```


------------------------------------------------------------------------


![](./asset/index_p.png){fig-align="center" width="100vw" height="100vh" object-fit="cover"}


```{python}
#| echo: false


df_long['A ìƒí’ˆêµ°ë³„(1)'] = df_long['A ìƒí’ˆêµ°ë³„(1)'].map(category_map)
df_long['B íŒë§¤ë§¤ì²´ë³„(1)'] = df_long['B íŒë§¤ë§¤ì²´ë³„(1)'].map(media_map)

# ìƒí’ˆêµ° + íŒë§¤ë§¤ì²´ë³„ë¡œ ê±°ë˜ì•¡ ì´í•©
grouped = df_long.groupby(['A ìƒí’ˆêµ°ë³„(1)', 'B íŒë§¤ë§¤ì²´ë³„(1)'])['ê±°ë˜ì•¡(ë°±ë§Œì›)'].sum().reset_index()

# ì¸í„°ë„·/ëª¨ë°”ì¼ì„ ì—´ë¡œ pivot
pivot_df = grouped.pivot(index='A ìƒí’ˆêµ°ë³„(1)', columns='B íŒë§¤ë§¤ì²´ë³„(1)', values='ê±°ë˜ì•¡(ë°±ë§Œì›)').fillna(0)

df_long.columns

df_long.rename(columns={
    'A ìƒí’ˆêµ°ë³„(1)': 'ìƒí’ˆêµ°ì½”ë“œ',
    'A ìƒí’ˆêµ°ë³„(2)': 'ìƒí’ˆêµ°ì„¸ë¶€',
    'B íŒë§¤ë§¤ì²´ë³„(1)': 'íŒë§¤ë§¤ì²´',
    'ì—°ì›”': 'ë…„ì›”',
    'ê±°ë˜ì•¡(ë°±ë§Œì›)': 'ê±°ë˜ì•¡_ë°±ë§Œì›'
}, inplace=True)

df_long


# ë…„ì›” ë°ì´í„° ì „ì²˜ë¦¬
df_long['ë…„ì›”'] = df_long['ë…„ì›”'].str.extract(r'(\d{4}\.\d{2})')
df_long['ë…„ì›”'] = pd.to_datetime(df_long['ë…„ì›”'], format='%Y.%m')


df_long['íŒë§¤ë§¤ì²´'].fillna('Total', inplace=True)

df_long[(df_long['ë…„ì›”'] == '2017-01-01') & (df_long['íŒë§¤ë§¤ì²´'] == 'Internet')]

df_long = df_long[df_long['ìƒí’ˆêµ°ì„¸ë¶€'] == 'ì†Œê³„']

df_long.drop(columns='ìƒí’ˆêµ°ì„¸ë¶€', inplace=True)
```

------------------------------------------------------------------------

## ğŸ“Š ì˜¨ë¼ì¸ì‡¼í•‘ ê±°ë˜ ë°ì´í„° ë¶„ì„

-   **ğŸ“Œ ì¶œì²˜**: í†µê³„ì²­ ì˜¨ë¼ì¸ì‡¼í•‘ ë™í–¥\
-   **ğŸ“† ë¶„ì„ ê¸°ê°„**: 2017ë…„ \~ 2025ë…„\
-   **ğŸ“‚ ë¶„ì„ ê¸°ì¤€**: ìƒí’ˆêµ°, íŒë§¤ë§¤ì²´, ì›”ë³„ ê±°ë˜ì•¡\
-   **ğŸ›ï¸ ì´ 23ê°œ ìƒí’ˆêµ°**ì„ ëŒ€ìƒìœ¼ë¡œ ë¶„ì„

```{python}
#| echo: false
print(df_long.info())
```

------------------------------------------------------------------------

## ì£¼ì œ 1. íŒë§¤ ê¸ˆì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„í•´ë³´ì

> "ìµœê·¼ ì˜¨ë¼ì¸ ì‡¼í•‘ í’ˆëª©êµ° ì¤‘, ë¬´ì—‡ì´ ìœ ë§í• ê¹Œ?!"<br>*ì„¸ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ê°ë„ ë¶„ì„*

-   "ë‹¨ìˆœíˆ ë§ì´ íŒ”ë¦°ë‹¤ê³  ë‹¤ ìœ ë§í•œ ê±´ ì•„ë‹ˆë‹¤!"
-   3ê°€ì§€ ê´€ì ì—ì„œì˜ ìœ ë§ í’ˆëª© ë¶„ì„
    1.  ê±°ë˜ëŸ‰ì´ ì§„ì§œ ì¦ê°€í–ˆëŠ”ê°€? (t-test)
    2.  ì–¼ë§ˆë‚˜ ë§ì´ ì¦ê°€í–ˆëŠ”ê°€? (ì¦ê°€ìœ¨)
    3.  ê³„ì†í•´ì„œ ì„±ì¥í•  ê²ƒì¸ê°€? (íšŒê·€ ê¸°ìš¸ê¸°)

------------------------------------------------------------------------

## ë¶„ì„ (1) - í‰ê·  ì°¨ì´ ê²€ì • (t-test)

> "ê³¼ê±°ë³´ë‹¤ ì§„ì§œë¡œ ë§ì´ íŒ”ë ¸ì„ê¹Œ?"

### ì‹œê°í™”

```{python}
#| echo: false
early = df_long[df_long['ë…„ì›”'].dt.year <= 2019]
recent = df_long[(df_long['ë…„ì›”'].dt.year >= 2022) & (df_long['ë…„ì›”'].dt.year <= 2024)]

early = early[early['ìƒí’ˆêµ°ì½”ë“œ'] != 'Total']
recent = recent[recent['ìƒí’ˆêµ°ì½”ë“œ'] != 'Total']

results = []

for category in df_long['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    early_vals = early[early['ìƒí’ˆêµ°ì½”ë“œ'] == category]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    recent_vals = recent[recent['ìƒí’ˆêµ°ì½”ë“œ'] == category]['ê±°ë˜ì•¡_ë°±ë§Œì›']

    if len(early_vals) > 1 and len(recent_vals) > 1:
        t_stat, p_value = ttest_ind(recent_vals, early_vals, equal_var=False)
        results.append({
            'ìƒí’ˆêµ°ì½”ë“œ': category,
            'ì´ì „í‰ê· ': early_vals.mean(),
            'ìµœê·¼í‰ê· ': recent_vals.mean(),
            'ì°¨ì´': recent_vals.mean() - early_vals.mean(),
            'p-value': p_value
        })


result_df = pd.DataFrame(results).sort_values('ì°¨ì´', ascending=False)
```

```{python}
#| echo: false
top10 = result_df.sort_values('ì°¨ì´', ascending=False).head(10)
result_df['label'] = result_df['ìƒí’ˆêµ°ì½”ë“œ'].where(result_df['ìƒí’ˆêµ°ì½”ë“œ'].isin(top10['ìƒí’ˆêµ°ì½”ë“œ']))
fig = px.scatter(
    result_df,
    x='ì´ì „í‰ê· ',
    y='ìµœê·¼í‰ê· ',
    color='ì°¨ì´',
    size='ì°¨ì´',
    size_max=80,
    hover_name='ìƒí’ˆêµ°ì½”ë“œ',
    text='label',  
    color_continuous_scale='RdBu',
    title="ğŸ“Š ê³¼ê±° vs ìµœê·¼ í‰ê·  ê±°ë˜ì•¡ ë¹„êµ"
)
fig.update_traces(textposition='top center', textfont_size=15)
fig.update_layout(template='seaborn', width=1000, height=600)
fig.show()
```







### í’ˆëª©ë³„ ê³¼ê±° vs ìµœê·¼ í‰ê·  ë¹„êµ (t-test)

-   **ë¶„ì„ ë°©ë²•**: 2017\~2019 vs 2022\~2024 í‰ê·  ê±°ë˜ì•¡ ë¹„êµ
-   **ê²€ì • ë°©ë²•**: ë…ë¦½í‘œë³¸ t-ê²€ì •
-   ê°€ì„¤
    -   Hâ‚€: ë‘ ì‹œê¸°ì˜ í‰ê·  ê±°ë˜ì•¡ì— ì°¨ì´ê°€ ì—†ë‹¤
    -   Hâ‚: ë‘ ì‹œê¸°ì˜ í‰ê·  ê±°ë˜ì•¡ì— ì°¨ì´ê°€ ìˆë‹¤

```{python}
#| code-fold: false
for category in df_long['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    early_vals = early[early['ìƒí’ˆêµ°ì½”ë“œ'] == category]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    recent_vals = recent[recent['ìƒí’ˆêµ°ì½”ë“œ'] == category]['ê±°ë˜ì•¡_ë°±ë§Œì›']

    if len(early_vals) > 1 and len(recent_vals) > 1:
        t_stat, p_value = ttest_ind(recent_vals, early_vals, equal_var=False)
        results.append({
            'ìƒí’ˆêµ°ì½”ë“œ': category,
            'ì´ì „í‰ê· ': early_vals.mean(),
            'ìµœê·¼í‰ê· ': recent_vals.mean(),
            'ì°¨ì´': recent_vals.mean() - early_vals.mean(),
            'p-value': p_value
        })



result_df = pd.DataFrame(results).sort_values('ì°¨ì´', ascending=False)

result_df.drop(columns='ì°¨ì´').reset_index(drop=True).style.format({
    'ì´ì „í‰ê· ': '{:,.0f}',   # ì²œ ë‹¨ìœ„ ì‰¼í‘œ + ì •ìˆ˜ë¡œ
    'ìµœê·¼í‰ê· ': '{:,.0f}',
    'p-value': '{:.1e}'      # ì§€ìˆ˜í‘œí˜„ ìœ ì§€
})
```



####  2017~2019 ëŒ€ë¹„ 2022~2024 í‰ê·  ê±°ë˜ì•¡ ì°¨ì´ TOP 10
(*t-ê²€ì • ê¸°ë°˜ ìœ ì˜ë¯¸í•œ ì¦ê°€ í’ˆëª©êµ°*)

| ìˆœìœ„ | ìƒí’ˆêµ°             | íŠ¹ì§• ìš”ì•½                              |
|------|--------------------|-----------------------------------------|
| 1    | Food Service       | **ê°€ì¥ ë†’ì€ í‰ê·  ê±°ë˜ì•¡ ìƒìŠ¹**          |
| 2    | Food & Beverages   | **ê¾¸ì¤€í•œ ì¦ê°€ì„¸, ê±°ë˜ ê·œëª¨ë„ í¼**       |
| 3    | Electronics         | **ì†Œë¹„ì ìˆ˜ìš” ì•ˆì •ì **                  |
| 4    | Travel & Transport | **ì½”ë¡œë‚˜ íšŒë³µ í›„ ë°˜ë“± í’ˆëª©**            |
| 5    | Household Goods    | **ìƒí™œ í•„ìˆ˜ì¬ë¡œ ì•ˆì •ëœ íŒë§¤**           |
| 6    | Agricultural Products | **ê°€íŒŒë¥¸ ì„±ì¥, ê¸°ì´ˆ ì†Œë¹„ì¬**         |
| 7    | Clothing           | **ê¸°ë³¸ ìˆ˜ìš” ì§€ì†ë¨**                    |
| 8    | E-Coupon Service   | **ë””ì§€í„¸ ì†Œë¹„ íŠ¸ë Œë“œì™€ ë§ë¬¼ë¦¼**         |
| 9    | Automobiles        | **ìƒëŒ€ì  ê±°ë˜ ì¦ê°€í­ ë§¤ìš° í¼**          |
| 10   | Computer           | **ìƒëŒ€ì ìœ¼ë¡œ ì™„ë§Œí•˜ì§€ë§Œ ì§€ì†ì ì¸ ì¦ê°€** |

------------------------------------------------------------------------

## ë¶„ì„ (2) - ë¹„ìœ¨ ì¦ê°€ìœ¨

> "ê³¼ê±° ëŒ€ë¹„ ëª‡ ë°°ë‚˜ ì„±ì¥í–ˆì„ê¹Œ?"

-   **ê¸°ì¤€**: ì¦ê°€ìœ¨ = (ìµœê·¼ - ê³¼ê±°) / ê³¼ê±°
-   **ì˜ë¯¸**: ê³¼ê±° ê±°ë˜ì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ ê±°ë˜ì•¡ì´ ëª‡ ë°°ë¡œ ì¦ê°€í–ˆëŠ”ì§€ í™•ì¸

```{python}
#| echo: false
df_long['ì—°ë„'] = df_long['ë…„ì›”'].dt.year
df_long['ì›”'] = df_long['ë…„ì›”'].dt.month
df_long_without_total = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] != 'Total']

avg_early = df_long_without_total[df_long_without_total['ì—°ë„'].between(2017, 2019)].groupby('ìƒí’ˆêµ°ì½”ë“œ')['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index(name='ê³¼ê±°í‰ê· ')
avg_recent = df_long_without_total[df_long_without_total['ì—°ë„'].between(2022, 2024)].groupby('ìƒí’ˆêµ°ì½”ë“œ')['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index(name='ìµœê·¼í‰ê· ')

merged = pd.merge(avg_early, avg_recent, on='ìƒí’ˆêµ°ì½”ë“œ')
merged['ì¦ê°€ë°°ìˆ˜'] = merged['ìµœê·¼í‰ê· '] / merged['ê³¼ê±°í‰ê· ']
merged_sorted = merged.sort_values('ì¦ê°€ë°°ìˆ˜', ascending=False)
```


```{python}
#| echo: false
# Top 10 ìƒí’ˆêµ° ì¶”ì¶œ
top10 = merged_sorted.head(10)['ìƒí’ˆêµ°ì½”ë“œ'].tolist()

# Trace ë¦¬ìŠ¤íŠ¸ ìƒì„±
bars = []

for _, row in merged_sorted.iterrows():
    is_top10 = row['ìƒí’ˆêµ°ì½”ë“œ'] in top10
    bars.append(
        go.Bar(
            x=[row['ì¦ê°€ë°°ìˆ˜']],
            y=[row['ìƒí’ˆêµ°ì½”ë“œ']],
            orientation='h',
            name=row['ìƒí’ˆêµ°ì½”ë“œ'],
            marker_color='indianred' if is_top10 else 'lightblue',
            text=f"{row['ì¦ê°€ë°°ìˆ˜']:.2f}ë°°" if is_top10 else None,
            textposition='outside' if is_top10 else None,
            hovertemplate='ìƒí’ˆêµ°: %{y}<br>ì¦ê°€ë°°ìˆ˜: %{x:.2f}ë°°<extra></extra>'
        )
    )

# ë ˆì´ì•„ì›ƒ ì„¤ì •
layout = go.Layout(
    title="ğŸ“Š 2017~2019 ëŒ€ë¹„ 2022~2024 ê±°ë˜ì•¡ ì¦ê°€ ë°°ìˆ˜ (Top10 ê°•ì¡°)",
    xaxis_title="ì¦ê°€ ë°°ìˆ˜",
    yaxis_title="ìƒí’ˆêµ°",
    barmode='stack',
    width=1000,
    height=700,
    template='seaborn',
    showlegend=False,
)

# ê¸°ì¤€ì„  1 ì¶”ê°€
layout.shapes = [
    dict(
        type='line',
        x0=1, x1=1,
        y0=-0.5, y1=len(merged_sorted)-0.5,
        line=dict(color='gray', dash='dash')
    )
]

# ê·¸ë¦¼ ì¶œë ¥
fig = go.Figure(data=bars, layout=layout)
fig.show()
```


####  2017~2019 ëŒ€ë¹„ 2022~2024 **ê±°ë˜ì•¡ ì¦ê°€ ë°°ìˆ˜** TOP 10

| ìˆœìœ„ | ìƒí’ˆêµ°             | ì¦ê°€ ë°°ìˆ˜ |
|------|--------------------|-----------|
| 1    | Food Service       | **5.7ë°°** |
| 2    | Automobiles        | **4.4ë°°** |
| 3    | E-Coupon Service   | **3.88ë°°** |
| 4    | Agricultural Products | **3.66ë°°** |
| 5    | Pet Supplies       | **3.04ë°°** |
| 6    | Food & Beverages   | **2.86ë°°** |
| 7    | Other Services     | **2.62ë°°** |
| 8    | Office Supplies    | **2.31ë°°** |
| 9    | Household Goods    | **2.01ë°°** |
| 10   | Shoes              | **1.93ë°°** |


------------------------------------------------------------------------

## ë¶„ì„ (3) - íšŒê·€ë¶„ì„ (ê¸°ìš¸ê¸°)

> "ë‹¨ë°œì„± ìœ í–‰ì´ ì•„ë‹ˆë¼, ê¾¸ì¤€íˆ ëŠ˜ê³  ìˆë‚˜? ê·¸ëŸ¼ ë‚´ë…„ì—ëŠ”?"

-   **ë¶„ì„ ë°©ë²•**: ì—°ë„ë³„ í‰ê·  ê±°ë˜ì•¡ â†’ ì„ í˜• íšŒê·€
-   **ê¸°ì¤€**: íšŒê·€ì„ ì˜ ê¸°ìš¸ê¸° = ì—°ë„ë‹¹ í‰ê·  ì¦ê°€ëŸ‰

```{python}
#| code-fold: false
grouped = df_long_without_total.groupby(['ì—°ë„', 'ìƒí’ˆêµ°ì½”ë“œ'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index()

# ê²°ê³¼ ì €ì¥ ë¦¬ìŠ¤íŠ¸
regression_results = []
grouped.columns
for category in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_category = grouped[grouped['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    
    if len(df_category) > 1:
        model = smf.ols('Q("ê±°ë˜ì•¡_ë°±ë§Œì›") ~ ì—°ë„', data=df_category).fit()
        coef = model.params['ì—°ë„']
        pval = model.pvalues['ì—°ë„']
        rsq = model.rsquared

        regression_results.append({
            'ìƒí’ˆêµ°ì½”ë“œ': category,
            'ê¸°ìš¸ê¸°': coef,
            'p-value': pval,
            'R-squared': rsq
        })

# ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ ì •ë ¬
regression_df = pd.DataFrame(regression_results).sort_values(by='ê¸°ìš¸ê¸°', ascending=False)
```


```{python}
#| echo: false

df_long_w_t_w_t = df_long_without_total[df_long_without_total['íŒë§¤ë§¤ì²´'] != 'Total']
grouped = df_long_w_t_w_t.groupby(['ì—°ë„', 'ìƒí’ˆêµ°ì½”ë“œ'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index()

grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique()

# íšŒê·€ì„  í¬í•¨ ë°ì´í„° ìƒì„±
plot_df = pd.DataFrame()
for cat in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_cat = grouped[grouped['ìƒí’ˆêµ°ì½”ë“œ'] == cat].copy()
    model = smf.ols('Q("ê±°ë˜ì•¡_ë°±ë§Œì›") ~ ì—°ë„', data=df_cat).fit()
    df_cat['ì˜ˆì¸¡ê°’'] = model.predict(df_cat)
    df_cat['ê·¸ë£¹'] = 'ì „ì²´'
    plot_df = pd.concat([plot_df, df_cat])

future_df = pd.DataFrame()
for cat in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_cat = grouped[grouped['ìƒí’ˆêµ°ì½”ë“œ'] == cat].copy()
    model = smf.ols('Q("ê±°ë˜ì•¡_ë°±ë§Œì›") ~ ì—°ë„', data=df_cat).fit()

    # ì‹¤ì œ ë§ˆì§€ë§‰ ì—°ë„ ê°’ (2024)
    y_2024 = df_cat[df_cat['ì—°ë„'] == 2024]['ê±°ë˜ì•¡_ë°±ë§Œì›'].values[0]

    # 2025 ì˜ˆì¸¡ê°’
    y_2025 = model.predict(pd.DataFrame({'ì—°ë„': [2025]})).values[0]

    # ì´ì–´ë¶™ì¼ ë°ì´í„°í”„ë ˆì„
    temp_df = pd.DataFrame({
        'ìƒí’ˆêµ°ì½”ë“œ': [cat, cat],
        'ì—°ë„': [2024, 2025],
        'ì˜ˆì¸¡ê°’': [y_2024, y_2025]
    })

    future_df = pd.concat([future_df, temp_df], ignore_index=True)



fig = go.Figure()

# ì‹¤ì œê°’: 2024ê¹Œì§€ ì‹¤ì„ 
df_actual_plot = plot_df[plot_df['ì—°ë„'] <= 2024]
for cat in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_cat = df_actual_plot[df_actual_plot['ìƒí’ˆêµ°ì½”ë“œ'] == cat]
    fig.add_trace(go.Scatter(
        x=df_cat['ì—°ë„'],
        y=df_cat['ê±°ë˜ì•¡_ë°±ë§Œì›'],
        mode='lines+markers',
        name=f'{cat} (ì‹¤ì œ)',
        line=dict(dash='solid'),
        opacity=0.3
    ))

# ì˜ˆì¸¡ê°’: 2024~2025 ì ì„  (ì•ì— 2024 ì‹¤ì¸¡ ë¶™ì—¬ì„œ ì´ì–´ì§)
for cat in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_cat = future_df[future_df['ìƒí’ˆêµ°ì½”ë“œ'] == cat]
    fig.add_trace(go.Scatter(
        x=df_cat['ì—°ë„'],
        y=df_cat['ì˜ˆì¸¡ê°’'],
        mode='lines+markers',
        name=f'{cat} (ì˜ˆì¸¡)',
        line=dict(dash='dot'),
    ))

# ë ˆì´ì•„ì›ƒ
fig.update_layout(
    title='ìƒí’ˆêµ°ë³„ ê±°ë˜ì•¡ ì¶”ì´ (2024 ì‹¤ì œ + 2025 ì˜ˆì¸¡)',
    xaxis_title='ì—°ë„',
    yaxis_title='í‰ê·  ê±°ë˜ì•¡ (ë°±ë§Œì›)',
    template='simple_white',
    width=1000,
    height=800,  # â¬…ï¸ ê¸°ì¡´ 600 â†’ 800ìœ¼ë¡œ ë†’ì„
    legend_title='ìƒí’ˆêµ°ì½”ë“œ',
    hovermode='x unified',
    yaxis=dict(
        tickformat=',',  # ì²œ ë‹¨ìœ„ ì½¤ë§ˆ í‘œì‹œ
        tick0=0,         # ì‹œì‘ ê°’
        dtick=200000,    # â¬…ï¸ ì´ê±¸ë¡œ ë‹¨ìœ„ ê°„ê²© ì¡°ì ˆ (ì˜ˆ: 20ë§Œ ë‹¨ìœ„)
        title_font=dict(size=14),
    )
)

fig.update_layout(
    shapes=[
        # 2025ë…„ í•˜ì´ë¼ì´íŠ¸ ì˜ì—­ (ë°°ê²½ ìƒ‰ ì¶”ê°€)
        dict(
            type="rect",
            xref="x", yref="paper",
            x0=2024, x1=2025,
            y0=0, y1=1,
            fillcolor="LightSalmon",
            opacity=0.2,
            layer="below",
            line_width=3,
        )
    ]
)

fig.show()

```


### ë‚´ë…„ê¹Œì§€ ì­‰ ì˜¤ë¥¸ë‹¤?!
### ë°ì´í„°ë¡œ ì˜ˆì¸¡í•œ í’ˆëª©ë³„ ì„±ì¥ ì†ë„ TOP 10

| ìˆœìœ„ | ìƒí’ˆêµ° | ê¸°ìš¸ê¸° |
|-----|------------------|------------| 
| 1 | Food Service | 238,228 |
| 2 | Food & Beverages | 123,202 |
| 3 | Electronics | 99,154 |
| 4 | Agricultural Products | 74,433 |
| 5 | Computer | 65,871 |
| 6 | Household Goods | 46,130 |
| 7 | Cosmetics | 33,091 |
| 8 | E-Coupon Service | 27,776 |
| 9 | Other Services | 24,808 |
| 10 | Furniture | 23,117 |

------------------------------------------------------------------------

## ğŸ¯ ì²«ë²ˆì§¸ ì£¼ì œë¥¼ í†µí•œ ì¶”ë ¤ì§„ Top 10 í’ˆëª©êµ°

| ìˆœìœ„ | í’ˆëª©êµ° | ì´ìœ  ìš”ì•½ |
|------|----------------------|-----------------------|
| 1 | Food Service | ëª¨ë“  ë¶„ì„ì—ì„œ 1ìœ„<br>ì••ë„ì  ê±°ë˜ì•¡<br>4.7ë°° ì¦ê°€<br>íšŒê·€ ê¸°ìš¸ê¸° ìµœìƒ |
| 2 | Food & Beverages | ê±°ë˜ì•¡ 2ìœ„<br>íšŒê·€ ê¸°ìš¸ê¸° 2ìœ„<br>ì¦ê°€ìœ¨ë„ ì¤‘ìƒìœ„ |
| 3 | Agricultural Products | ì¦ê°€ìœ¨ 2.6ë°°<br>íšŒê·€ ê¸°ìš¸ê¸° 5ìœ„<br>ì „ë°˜ì ìœ¼ë¡œ ê³ ì„±ì¥ |
| 4 | E-Coupon Service | ì¦ê°€ìœ¨ 2.9ë°°<br>íšŒê·€ ê¸°ìš¸ê¸° 8ìœ„<br>ë””ì§€í„¸ ì†Œë¹„ íŠ¸ë Œë“œì™€ ë§ë¬¼ë¦¼ |
| 5 | Automobiles | ì¦ê°€ìœ¨ 3.4ë°°<br>íšŒê·€ ê¸°ìš¸ê¸° 9ìœ„<br>t-test ìƒìœ„ê¶Œ |
| 6 | Household Goods | íšŒê·€ ê¸°ìš¸ê¸° 6ìœ„<br>ì „ì²´ì ìœ¼ë¡œ ìƒìŠ¹ ì•ˆì •ì <br>ìƒí™œí•„ìˆ˜ì¬ ìˆ˜ìš” ì¦ê°€ |
| 7 | Electronics | ê±°ë˜ì•¡ 3ìœ„<br>íšŒê·€ ê¸°ìš¸ê¸° 4ìœ„<br>ê¾¸ì¤€í•œ ìˆ˜ìš” |
| 8 | Travel & Transport | íšŒê·€ ê¸°ìš¸ê¸° 3ìœ„<br>ì½”ë¡œë‚˜ ì´í›„ ë°˜ë“± ê¸°ëŒ€ í’ˆëª© |
| 9 | Clothing | íšŒê·€ ê¸°ìš¸ê¸° 7ìœ„<br>ì—¬ì „íˆ ê¸°ë³¸ ìˆ˜ìš” ìœ ì§€ |
| 10 | Computer | ê³ ì„±ì¥ í’ˆëª©ì€ ì•„ë‹˜<br>í•˜ì§€ë§Œ ê¾¸ì¤€íˆ ìƒìœ„ê¶Œ<br>íšŒê·€ ê¸°ìš¸ê¸° 10ìœ„ |


---

## ì£¼ì œ 2. ì¼ì‹œì  ìœ í–‰ ì•„ë‹Œ, ê¾¸ì¤€íˆ ì„±ì¥í•˜ëŠ” í’ˆëª©ì€?

> ê±°ë˜ ë³€ë™ì„±ì´ ì ì€ ìŠ¤í…Œë””ì…€ëŸ¬ ìƒí’ˆì„ ì°¾ì•„ë¼! <br />(with ì„ í˜•íšŒê·€ ë¶„ì„)

- í’ˆêµ°ë³„ ê±°ë˜ì•¡ì˜ ë¶„ì‚°(ë³€ë™ì„±)ì„ ê³„ì‚°
- ê±°ë˜ì•¡ì˜ ë³€ë™ì„± ìˆœìœ„í™”

```{python}
#| echo: false
#| fig-width: 4
#| fig-height: 2
import pandas as pd
import numpy as np
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import seaborn as sns

# í•„í„° ë° ì „ì²˜ë¦¬
filtered_codes = ['Food Service', 'Food & Beverages', 'Agricultural Products', 'E-Coupon Service', 'Automobiles', 'Household Goods', 'Electronics', 'Travel & Transport', 'Clothing', 'Computer']

df_filtered_10 = df_long_without_total[df_long_without_total['ìƒí’ˆêµ°ì½”ë“œ'].isin(filtered_codes)]
df_filtered = df_filtered_10[(df_filtered_10['ì—°ë„'] >= 2022) & (df_filtered_10['ì—°ë„'] <= 2024)]
```

```{python}
# ì—°ë„ë³„ ê±°ë˜ì•¡ í•©ê³„
grouped_var = df_filtered.groupby(['ì—°ë„', 'ìƒí’ˆêµ°ì½”ë“œ'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].sum().reset_index()

# ë¶„ì‚° ê³„ì‚°
var_df = grouped_var.groupby('ìƒí’ˆêµ°ì½”ë“œ')['ê±°ë˜ì•¡_ë°±ë§Œì›'].var().reset_index(name='ê±°ë˜ì•¡_ë¶„ì‚°')
```

```{python}
#| echo: false
cutoff = 5e+12

data = var_df.sort_values('ê±°ë˜ì•¡_ë¶„ì‚°', ascending=True).copy()
data['í´ë¦¬í•‘ëœë¶„ì‚°'] = np.minimum(data['ê±°ë˜ì•¡_ë¶„ì‚°'], cutoff)
colors = sns.color_palette("Blues", len(data))[::-1]
data['color'] = colors

# ë¶„í• 
data_small = data.copy()
data_large = data[data['ê±°ë˜ì•¡_ë¶„ì‚°'] > cutoff]

fig = make_subplots(rows=1, cols=2, shared_yaxes=True, column_widths=[0.7, 0.3])

fig.add_trace(go.Bar(
    y=data_small['ìƒí’ˆêµ°ì½”ë“œ'],
    x=data_small['í´ë¦¬í•‘ëœë¶„ì‚°'],
    orientation='h',
    text=[f"{v:,.0f}" for v in data_small['ê±°ë˜ì•¡_ë¶„ì‚°']],
    textposition="outside",
    marker_color=[f'rgba({int(r*255)},{int(g*255)},{int(b*255)},1)' for r, g, b in data_small['color']]
), row=1, col=1)

fig.add_trace(go.Bar(
    y=data_large['ìƒí’ˆêµ°ì½”ë“œ'],
    x=data_large['ê±°ë˜ì•¡_ë¶„ì‚°'],
    orientation='h',
    text=[f"{v:,.0f}" for v in data_large['ê±°ë˜ì•¡_ë¶„ì‚°']],
    textposition="outside",
    marker_color=[f'rgba({int(r*255)},{int(g*255)},{int(b*255)},1)' for r, g, b in data_large['color']]
), row=1, col=2)

fig.update_layout(
    height=600,
    width=1000,
    title_text="2022~2024ë…„ í’ˆëª©ë³„ ê±°ë˜ì•¡ ë¶„ì‚°",
    plot_bgcolor='#f9f9f9',
    paper_bgcolor='#f9f9f9',
    font=dict(size=12),
    margin=dict(t=80)
)
fig.update_yaxes(title_text="ìƒí’ˆêµ°", autorange="reversed")
fig.show()
```


---

## ìƒí’ˆêµ°ë³„ ì„±ì¥ë¥ ê³¼ ë³€ë™ì„±ì˜ ìƒê´€ê´€ê³„

```{python}
#| echo: false
import pandas as pd
import plotly.graph_objects as go
import plotly.express as px
from scipy.stats import pearsonr
import statsmodels.formula.api as smf
import numpy as np
import statsmodels.api as sm

# ì—°ë„ë³„ í‰ê·  ì§‘ê³„
grouped = df_filtered_10.groupby(['ì—°ë„', 'ìƒí’ˆêµ°ì½”ë“œ'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index()
```

1. ìƒí’ˆêµ° ë³„ ì—°ë„(x)ì— ë”°ë¥¸ ê±°ë˜ì•¡(y) ë³€í™” (ì„ í˜•íšŒê·€ë¶„ì„)

```{python}
#| echo: false
regression_results = []

for category in grouped['ìƒí’ˆêµ°ì½”ë“œ'].unique():
    df_category = grouped[grouped['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    if len(df_category) > 1:
        model = smf.ols('Q("ê±°ë˜ì•¡_ë°±ë§Œì›") ~ ì—°ë„', data=df_category).fit()
        coef = model.params['ì—°ë„']
        regression_results.append({'ìƒí’ˆêµ°ì½”ë“œ': category,'ê¸°ìš¸ê¸°': coef})
```

```{python}
#| echo: false
regression_df = pd.DataFrame(regression_results)

# ë¶„ì‚° ê³„ì‚°
var_df = grouped.groupby('ìƒí’ˆêµ°ì½”ë“œ')['ê±°ë˜ì•¡_ë°±ë§Œì›'].var().reset_index(name='ê±°ë˜ì•¡_ë¶„ì‚°')

df_corr = pd.merge(regression_df, var_df, on='ìƒí’ˆêµ°ì½”ë“œ')
```

2. ìƒí’ˆêµ°ì˜ ì„±ì¥ë¥ (ê¸°ìš¸ê¸°)ê³¼ ê±°ë˜ì•¡ ë¶„ì‚° ê°„ì˜ ìƒê´€ê´€ê³„

```{python}
corr_coef, p_value = pearsonr(df_corr['ê¸°ìš¸ê¸°'], df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'])
print(f"â–¶ ìƒê´€ê³„ìˆ˜ (ê¸°ìš¸ê¸° vs ë¶„ì‚°): r = {corr_coef:.4f}, p-value = {p_value:.4f}")
```

```{python}
#| echo: false
text_positions = []

for idx, row in df_corr.iterrows():
    if row['ê±°ë˜ì•¡_ë¶„ì‚°'] > df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'].quantile(0.8):
        text_positions.append('middle right')
    elif row['ê±°ë˜ì•¡_ë¶„ì‚°'] > df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'].quantile(0.4):
        text_positions.append('top center')
    else:
        text_positions.append('top right')

for i, row in enumerate(df_corr['ìƒí’ˆêµ°ì½”ë“œ']):
    if row == 'Computer':
        text_positions[i] = 'bottom left'
    elif row == 'Automobiles':
        text_positions[i] = 'top center'

df_corr['text_position'] = text_positions

base_offset = df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'].max() * 0.1
df_corr['text_y'] = df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'] + base_offset
```

3. ì„±ì¥ë¥ (ê¸°ìš¸ê¸°)-ë¶„ì‚°ë¡œ í•˜ëŠ” ë˜ ë‹¤ë¥¸ íšŒê·€ë¶„ì„(ì„ í˜•íšŒê·€ë¶„ì„)

```{python}
# íšŒê·€ ëª¨ë¸ ë° ì‹ ë¢°êµ¬ê°„ ê³„ì‚°
x = df_corr['ê¸°ìš¸ê¸°']
y = df_corr['ê±°ë˜ì•¡_ë¶„ì‚°']

# íšŒê·€ ëª¨ë¸ ìƒì„±
X = sm.add_constant(x)
model = sm.OLS(y, X).fit()
```

```{python}
#| echo: false
# ì˜ˆì¸¡ê°’ ìƒì„±ì„ ìœ„í•œ x ê°’ ë²”ìœ„
x_range = np.linspace(x.min(), x.max(), 100)
X_pred = sm.add_constant(x_range)
```

```{python}
predictions = model.get_prediction(X_pred)
frame = predictions.summary_frame(alpha=0.05)  # 95% ì‹ ë¢°êµ¬ê°„
```

```{python}
#| echo: false
fig = go.Figure()

fig.add_trace(go.Scatter(
    x=x_range,
    y=frame['mean'],
    mode='lines',
    line=dict(color='red', width=2),
    name='íšŒê·€ì„ '
))

fig.add_trace(go.Scatter(
    x=x_range,
    y=frame['mean_ci_lower'],
    mode='lines',
    line=dict(width=0),
    showlegend=False
))

fig.add_trace(go.Scatter(
    x=x_range,
    y=frame['mean_ci_upper'],
    mode='lines',
    line=dict(width=0),
    fill='tonexty',
    fillcolor='rgba(255, 0, 0, 0.2)',
    name='95% ì‹ ë¢°êµ¬ê°„'
))

fig.add_trace(go.Scatter(
    x=df_corr['ê¸°ìš¸ê¸°'],
    y=df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'],
    mode='markers',
    marker=dict(size=10, color='royalblue'),
    name='ë°ì´í„° ì ',
    text=df_corr['ìƒí’ˆêµ°ì½”ë“œ'],
    hovertemplate="<b>%{text}</b><br>ê¸°ìš¸ê¸°: %{x:.2f}<br>ë¶„ì‚°: %{y:,.0f}<extra></extra>",
))

for idx, row in df_corr.iterrows():
    fig.add_trace(go.Scatter(
        x=[row['ê¸°ìš¸ê¸°']],
        y=[row['text_y']],
        mode='text',
        text=[row['ìƒí’ˆêµ°ì½”ë“œ']],
        textfont=dict(size=12),
        textposition=row['text_position'],
        showlegend=False
    ))

fig.add_annotation(
    x=0.55 * df_corr['ê¸°ìš¸ê¸°'].max(),
    y=0.18 * df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'].max(),
    text="ì„±ì¥ë¥ ì´ ë†’ì€ ìƒí’ˆêµ°ì¼ìˆ˜ë¡<br>ë³€ë™ì„±ë„ ë†’ì€ ê²½í–¥ì´ ìˆìŒ<br>(ê³ ì„±ì¥ = ê³ ìœ„í—˜)",
    showarrow=False,
    align='left',
    font=dict(size=12),
    bgcolor='lightyellow',
    bordercolor='gray',
    borderwidth=1,
    opacity=0.9
)

fig.add_annotation(
    x=0.05 * df_corr['ê¸°ìš¸ê¸°'].max(),
    y=0.9 * df_corr['ê±°ë˜ì•¡_ë¶„ì‚°'].max(),
    text=f"ìƒê´€ê³„ìˆ˜: r = {corr_coef:.4f}<br>p-value < 0.0001",
    showarrow=False,
    align='left',
    font=dict(size=12),
    bgcolor='white',
    bordercolor='gray',
    borderwidth=1,
    opacity=0.9
)

fig.update_layout(
    title='íšŒê·€ ê¸°ìš¸ê¸° vs ê±°ë˜ì•¡ ë¶„ì‚° (ì•ˆì •ì„± ë¶„ì„)',
    xaxis=dict(
        title='ê±°ë˜ì•¡ ì¦ê°€ ê¸°ìš¸ê¸° (ì—°ê°„ ì„±ì¥ë¥ )',
        title_font=dict(size=14),
        tickfont=dict(size=12)
    ),
    yaxis=dict(
        title='ê±°ë˜ì•¡ ë¶„ì‚° (ë³€ë™ì„±)',
        title_font=dict(size=14),
        tickfont=dict(size=12)
    ),
    margin=dict(t=80),
    font=dict(size=13),
    template='simple_white',
    height=600,
    width=800
)

fig.show()
```

---

## ì„±ì¥ë¥ ê³¼ ë³€ë™ì„±ì˜ ê´€ê³„

- ìƒí’ˆêµ°ì˜ ì„±ì¥ë¥ ê³¼ ë³€ë™ì„± ì‚¬ì´ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ê°•í•œ ì–‘ì˜ ìƒê´€ê´€ê³„ê°€ ìˆìŒ
- ì„±ì¥ë¥ ì´ ë†’ì€ í’ˆëª©ì¼ìˆ˜ë¡ ë³€ë™ì„±ë„ ë†’ì€ ê²½í–¥ì´ ìˆìŒ
- ì•ˆì •ì ì¸ ì„±ì¥ì„ ë³´ì´ëŠ” í’ˆëª©ì€ Computer, Electronics, Automobiles
- ë†’ì€ ì„±ì¥ë¥ ê³¼ í•¨ê»˜ ë†’ì€ ë³€ë™ì„±ì„ ë³´ì´ëŠ” í’ˆëª©ì€ Food Service, Food & Beverages

---

## ìµœì¢…ì ìœ¼ë¡œ ë¶„ì‚°ì´ ë‚®ì€ ìˆœìœ¼ë¡œ 5ê°œ ì„ íƒ!

#### **ë¶„ì‚° ë‚®ì€ ìˆœ TOP 5**

| ìˆœìœ„ | í•­ëª©             | ê±°ë˜ì•¡ ë¶„ì‚°              |
|-----|-----------------|-----------------------|
| ğŸ¥‡  |  Computer       | 402,199,096,492        |
| ğŸ¥ˆ  |  Electronics    | 1,984,946,558,970      |
| ğŸ¥‰  | Automobiles      | 2,453,297,729,299 |
| 4   | Clothing         | 4,285,422,325,214 |
| 5   | E-Coupon Service | 4,870,490,975,345 |

-----

## ì£¼ì œ 3. íŒ¬ë°ë¯¹ì´ e-commerce ì‹œì¥ì— ë¯¸ì¹œ ë³µí•©ì  ì˜í–¥ ë¶„ì„

> "íŒ¬ë°ë¯¹ ìƒí™©ì—ì„œë„ ì‚´ì•„ë‚¨ì„ ìˆ˜ ìˆëŠ” í’ˆëª©êµ°ì€ ë¬´ì—‡ì¼ê¹Œ?"

- "ë¬´ì¡°ê±´ ì˜ íŒ”ë¦¬ëŠ” ê²ƒ ë§ê³ , ì§„ì§œ **ê¸°íšŒ**ë¥¼ ì¡ì•„ë³´ì!"
- 4ê°€ì§€ ë°ì´í„° ë¶„ì„ìœ¼ë¡œ ìœ ë§ í’ˆëª©êµ° ë°œêµ´

  1. **íŒ¬ë°ë¯¹ ì´í›„ ë‹¬ë¼ì§„ ì†Œë¹„íŒ¨í„´** (ë³€í™”ìœ¨)
  2. **í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ë³€í™”ì¼ê¹Œ?** (Mann-Whitney U ê²€ì •)
  3. **íŒ¬ë°ë¯¹ ì‹œëŒ€, ì„±ì¥ ì¶”ì„¸ ë¶„ì„** (ê²°ì •ê³„ìˆ˜)
  4. **ì•ˆì •ì ì¸ ì„±ì¥ í’ˆëª©êµ°** (ì„±ì¥ë¥ ê³¼ ë³€ë™ì„±ì„ ë™ì‹œì— ê³ ë ¤í•œ ë³µí•©ì ìˆ˜)

---

## ë¶„ì„ (1) íŒ¬ë°ë¯¹ ì´í›„ ì†Œë¹„íŒ¨í„´ ë³€í™” ë¶„ì„

> ë¶„ì„: ì—°ê°„ ë³€í™”ìœ¨(%) ë¶„ì„ <br>
-   ëŒ€ìƒ: ì—°ê°„ ê±°ë˜ì•¡ ê¸°ì¤€ ìƒìœ„ 10ê°œ í’ˆëª©êµ° <br>
-   ê¸°ê°„: 2019~2021ë…„ (ì½”ë¡œë‚˜ ì „Â·í›„ 3ê°œë…„) <br>
-   í•µì‹¬ ì§€í‘œ: ì—°ê°„ ê±°ë˜ì•¡ ê·œëª¨ ë¹„êµ

```{python}
#| echo: false
import numpy as np

# ì—°ë„ ì¶”ì¶œ
df_long['Year'] = df_long['ë…„ì›”'].dt.year.astype(str)

# 2019, 2020, 2021ë…„ ë°ì´í„° í•„í„°ë§
df_3yrs = df_long[
    df_long['Year'].isin(['2019', '2020', '2021']) &
    (df_long['ìƒí’ˆêµ°ì½”ë“œ'] != 'Total')
]

# ìƒí’ˆêµ°ë³„, ì—°ë„ë³„ ê±°ë˜ì•¡ í•©ì‚°
yearly_total = df_3yrs.groupby(['ìƒí’ˆêµ°ì½”ë“œ', 'Year'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].sum().unstack()

# NaN ìˆëŠ” ìƒí’ˆêµ° ì œê±°
yearly_total = yearly_total.dropna()

# ìƒìœ„ 10ê°œ ìƒí’ˆêµ° ê¸°ì¤€ ì •ë ¬ (2021 ê±°ë˜ì•¡ ê¸°ì¤€)
top10 = yearly_total.sort_values(by='2021', ascending=False).head(10)

# ë³€í™”ìœ¨ ê³„ì‚°
top10['ë³€í™”ìœ¨(2019â†’2020)(%)'] = ((top10['2020'] - top10['2019']) / top10['2019']) * 100
top10['ë³€í™”ìœ¨(2020â†’2021)(%)'] = ((top10['2021'] - top10['2020']) / top10['2020']) * 100

import numpy as np
import matplotlib.pyplot as plt

# Travel & Transport ë¶„ë¦¬
tt_idx = top10.index.get_loc('Travel & Transport') if 'Travel & Transport' in top10.index else None

# Travel & Transportë§Œ ë”°ë¡œ, ë‚˜ë¨¸ì§€ 9ê°œ ë”°ë¡œ
if tt_idx is not None:
    top9 = top10.drop('Travel & Transport')
    tt = top10.loc[['Travel & Transport']]
else:
    top9 = top10
    tt = None

x9 = np.arange(len(top9.index))
width = 0.25

fig, axes = plt.subplots(1, 2, figsize=(18, 6), gridspec_kw={'width_ratios':[2,1]})

# (1) Travel & Transport ì œì™¸ 9ê°œ í’ˆëª©êµ°
axes[0].bar(x9 - width, top9['2019'], width=width, label='2019', color='skyblue')
axes[0].bar(x9, top9['2020'], width=width, label='2020', color='orange')
axes[0].bar(x9 + width, top9['2021'], width=width, label='2021', color='lightgreen')

# ë³€í™”ìœ¨ í…ìŠ¤íŠ¸
for i in range(len(top9)):
    change_1 = top9['ë³€í™”ìœ¨(2019â†’2020)(%)'].iloc[i]
    sign_1 = '+' if change_1 >= 0 else ''
    axes[0].text(x9[i], top9['2020'].iloc[i] + 100, f'{sign_1}{change_1:.1f}%', 
                 ha='center', va='bottom', fontsize=9, color='green' if change_1 >= 0 else 'red')
    change_2 = top9['ë³€í™”ìœ¨(2020â†’2021)(%)'].iloc[i]
    sign_2 = '+' if change_2 >= 0 else ''
    axes[0].text(x9[i] + width, top9['2021'].iloc[i] + 100, f'{sign_2}{change_2:.1f}%', 
                 ha='center', va='bottom', fontsize=9, color='green' if change_2 >= 0 else 'red')

axes[0].set_xticks(x9)
axes[0].set_xticklabels(top9.index, rotation=45, ha='right')
axes[0].set_ylabel('ê±°ë˜ì•¡ (ë°±ë§Œì›)')
axes[0].set_title('ìƒìœ„ í’ˆëª©êµ°')
axes[0].legend()
axes[0].grid(axis='y')

# (2) Travel & Transportë§Œ ë³„ë„ ì‹œê°í™”
if tt is not None:
    x_tt = np.arange(1)
    axes[1].bar(x_tt - width, tt['2019'], width=width, label='2019', color='skyblue')
    axes[1].bar(x_tt, tt['2020'], width=width, label='2020', color='orange')
    axes[1].bar(x_tt + width, tt['2021'], width=width, label='2021', color='lightgreen')

    # ë³€í™”ìœ¨ í…ìŠ¤íŠ¸
    change_1 = tt['ë³€í™”ìœ¨(2019â†’2020)(%)'].iloc[0]
    sign_1 = '+' if change_1 >= 0 else ''
    axes[1].text(x_tt[0], tt['2020'].iloc[0] + 100, f'{sign_1}{change_1:.1f}%', 
                 ha='center', va='bottom', fontsize=9, color='green' if change_1 >= 0 else 'red')
    change_2 = tt['ë³€í™”ìœ¨(2020â†’2021)(%)'].iloc[0]
    sign_2 = '+' if change_2 >= 0 else ''
    axes[1].text(x_tt[0] + width, tt['2021'].iloc[0] + 100, f'{sign_2}{change_2:.1f}%', 
                 ha='center', va='bottom', fontsize=9, color='green' if change_2 >= 0 else 'red')

    axes[1].set_xticks(x_tt)
    axes[1].set_xticklabels(['Travel & Transport'])
    axes[1].set_ylabel('ê±°ë˜ì•¡ (ë°±ë§Œì›)')
    axes[1].set_title('Travel & Transport')
    axes[1].legend()
    axes[1].grid(axis='y')

plt.tight_layout()
plt.show()
```

- íŒ¬ë°ë¯¹ ì´í›„ ì˜¨ë¼ì¸ ì‡¼í•‘ì—ì„œ ìƒí•„í’ˆ ì†Œë¹„ëŠ” ì¦ê°€í•˜ê³ , ì—¬í–‰Â·ë¬¸í™” ìƒí’ˆì€ í¬ê²Œ ê°ì†Œí•¨
- ì´ëŠ” ë¹„ëŒ€ë©´ ì¼ìƒê³¼ ì™¸ë¶€ í™œë™ ì œí•œì˜ ì˜í–¥ì„ ë°˜ì˜í•¨

---

## ë¶„ì„ (2) íŒ¬ë°ë¯¹ ì „í›„ë¡œ ê° í’ˆëª©êµ°ì˜ ê±°ë˜ì•¡ì´ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ê²Œ ë³€í™”í–ˆëŠ”ê°€?

```{python}
#| echo: false
import pandas as pd
import numpy as np
from scipy.stats import mannwhitneyu

# ë¶„ì„ ëŒ€ìƒ í’ˆëª©êµ°
target_categories = ['Computer', 'Electronics', 'Automobiles', 'Clothing', 'E-Coupon Service']

# ì½”ë¡œë‚˜ ì „í›„ ê¸°ê°„
pre_covid_start = pd.to_datetime('2018-01-01')
pre_covid_end = pd.to_datetime('2019-12-31')
post_covid_start = pd.to_datetime('2020-01-01')
post_covid_end = pd.to_datetime('2021-12-31')

results = []

for category in target_categories:
    df_cat = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    pre = df_cat[(df_cat['ë…„ì›”'] >= pre_covid_start) & (df_cat['ë…„ì›”'] <= pre_covid_end)]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    post = df_cat[(df_cat['ë…„ì›”'] >= post_covid_start) & (df_cat['ë…„ì›”'] <= post_covid_end)]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    n_pre, n_post = len(pre), len(post)
    # ë°ì´í„°ê°€ ì¶©ë¶„í•  ë•Œë§Œ ê²€ì • ìˆ˜í–‰
    if n_pre >= 2 and n_post >= 2:
        stat, p = mannwhitneyu(pre, post, alternative='two-sided')
    else:
        stat, p = np.nan, np.nan
    results.append({
        'í’ˆëª©êµ°': category,
        'ì „ í‰ê· (ë°±ë§Œì›)': pre.mean() if n_pre > 0 else np.nan,
        'í›„ í‰ê· (ë°±ë§Œì›)': post.mean() if n_post > 0 else np.nan,
        'U(í†µê³„ëŸ‰)': stat,
        'p-value': p
    })

results_df = pd.DataFrame(results).set_index('í’ˆëª©êµ°')

# ìˆ«ì í¬ë§· í†µì¼ (ìë¦¬ìˆ˜ ì¶•ì†Œ)
table = results_df.reset_index()
table['ì „ í‰ê· (ë°±ë§Œì›)'] = table['ì „ í‰ê· (ë°±ë§Œì›)'].map(lambda x: f"{x:,.0f}")
table['í›„ í‰ê· (ë°±ë§Œì›)'] = table['í›„ í‰ê· (ë°±ë§Œì›)'].map(lambda x: f"{x:,.0f}")
table['U(í†µê³„ëŸ‰)'] = table['U(í†µê³„ëŸ‰)'].map(lambda x: f"{x:.0f}")
table['p-value'] = table['p-value'].map(lambda x: f"{x:.2e}")

# ê° ì¹¼ëŸ¼ì˜ ìµœëŒ€ ë„ˆë¹„ ê³„ì‚°
columns = ['í’ˆëª©êµ°', 'ì „ í‰ê· (ë°±ë§Œì›)', 'í›„ í‰ê· (ë°±ë§Œì›)', 'U(í†µê³„ëŸ‰)', 'p-value']
col_widths = [max(table[col].astype(str).map(len).max(), len(col)) for col in columns]

# í—¤ë” ì¶œë ¥
# header = " | ".join([col.ljust(col_widths[i]) for i, col in enumerate(columns)])
# print(header)
# print("-" * len(header))

# ê° í–‰ ì¶œë ¥ (Uë§Œ ì™¼ìª½ ì •ë ¬, ë‚˜ë¨¸ì§€ëŠ” ì˜¤ë¥¸ìª½ ì •ë ¬)
# for idx, row in table.iterrows():
#     row_strs = []
#     for i, col in enumerate(columns):
#         val = str(row[col])
#         if col == 'U(í†µê³„ëŸ‰)':
#             row_strs.append(val.ljust(col_widths[i]))
#         else:
#             row_strs.append(val.rjust(col_widths[i]))
#     line = " | ".join(row_strs)
#     print(line)
```

| ìˆœìœ„ | í’ˆëª©êµ° | U(í†µê³„ëŸ‰) | p-value |
|-----|-------|-----------|---------|
| 1   | Computer | 1080 | 1.55e-09 |
| 2   | Electronics | 1454 | 5.50e-06 |
| 3   | Automobiles | 742 | 1.47e-13 |
| 4   | Clothing | 2303 | 2.49e-01 |
| 5   | E-Coupon Service | 1236 | 6.10e-08 |

- Mann-Whitney U testë¡œ ê²€ì • ê²°ê³¼
    - ëª¨ë“  í’ˆëª©êµ° **í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ë³€í™”(p<0.05)**
    - íŒ¬ë°ë¯¹ ì´í›„ ì†Œë¹„íŒ¨í„´ì´ ì‹¤ì œë¡œ í¬ê²Œ ë‹¬ë¼ì¡ŒìŒì„ ì˜ë¯¸

---

## ë¶„ì„ (3) íŒ¬ë°ë¯¹ ì „í›„ í’ˆëª©êµ°ë³„ ì„±ì¥ ì¶”ì„¸ ë¶„ì„

<!-- > ëª©ì : íŒ¬ë°ë¯¹ ì „í›„ ê° í’ˆëª©êµ°ì˜ ê±°ë˜ì•¡ ì„±ì¥ë¥ ê³¼ ë³€í™” íŒ¨í„´(ì¼ê´€ì„±) ë¶„ì„ <br> -->

- ê¸°ê°„: 2019~2021ë…„ (ì½”ë¡œë‚˜ ì „Â·í›„ 3ê°œë…„) <br>
- ì„±ì¥ë¥ : íŒ¬ë°ë¯¹ ì´í›„ í‰ê·  ê±°ë˜ì•¡ì´ ì´ì „ ëŒ€ë¹„ ì–¼ë§ˆë‚˜ ì¦ê°í–ˆëŠ”ì§€ <br>
- RÂ²: ê±°ë˜ì•¡ ë³€í™”ì˜ ì‹œê°„ì  ì¼ê´€ì„±(ì„ í˜•ì„±)ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ <br>

```{python}
#| echo: false
import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression

# ë¶„ì„ ëŒ€ìƒ í’ˆëª©êµ°
target_categories = ['Computer', 'Electronics', 'Automobiles', 'Clothing', 'E-Coupon Service']

# íŒ¬ë°ë¯¹ ì „í›„ ê¸°ê°„
pre_covid_start = pd.to_datetime('2018-01-01')
pre_covid_end = pd.to_datetime('2019-12-31')
post_covid_start = pd.to_datetime('2020-01-01')
post_covid_end = pd.to_datetime('2021-12-31')

summary = []

for category in target_categories:
    df_cat = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == category].copy()
    df_cat = df_cat.sort_values('ë…„ì›”')
    # ì„±ì¥ë¥ 
    pre = df_cat[(df_cat['ë…„ì›”'] >= pre_covid_start) & (df_cat['ë…„ì›”'] <= pre_covid_end)]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    post = df_cat[(df_cat['ë…„ì›”'] >= post_covid_start) & (df_cat['ë…„ì›”'] <= post_covid_end)]['ê±°ë˜ì•¡_ë°±ë§Œì›']
    avg_pre = pre.mean()
    avg_post = post.mean()
    growth_rate = (avg_post - avg_pre) / avg_pre if avg_pre != 0 else np.nan
    # RÂ² ê³„ì‚° (ì „ì²´ ê¸°ê°„)
    df_cat = df_cat.dropna(subset=['ê±°ë˜ì•¡_ë°±ë§Œì›'])
    if len(df_cat) > 1:
        X = np.arange(len(df_cat)).reshape(-1, 1)
        y = df_cat['ê±°ë˜ì•¡_ë°±ë§Œì›'].values
        model = LinearRegression().fit(X, y)
        r2 = model.score(X, y)
    else:
        r2 = np.nan
    summary.append({
        'í’ˆëª©êµ°': category,
        'íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ ': growth_rate,
        'R_squared': r2
    })

summary_df = pd.DataFrame(summary)
summary_df = summary_df.set_index('í’ˆëª©êµ°')
summary_df = summary_df.sort_values('íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ ', ascending=False)

print("\n=== í’ˆëª©êµ°ë³„ ì„±ì¥ë¥  ë° RÂ²(ë³´ì¡°ì§€í‘œ) Summary ===")
print(summary_df)
```

- RÂ² ê°’ì´ ì „ë°˜ì ìœ¼ë¡œ ë‚®ì•„ ëŒ€ë¶€ë¶„ í’ˆëª©êµ°ì—ì„œ ì„±ì¥ì„¸ê°€ ì¼ê´€ì ì´ì§€ ì•Šê³  ë³€ë™ì„±ì´ ìˆì—ˆìŒ
- ì´ëŠ” ì„±ì¥ë¥ ë¿ë§Œ ì•„ë‹ˆë¼ ë³€ë™ì„±ê¹Œì§€ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•¨ì„ ì˜ë¯¸
<!-- 
```{python}
#| echo: false
import matplotlib.pyplot as plt

# ì„±ì¥ë¥  ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìˆ˜í‰ ì  ê·¸ë˜í”„)
growth_df = summary_df.sort_values('íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ ', ascending=True)  # ì‘ì€ ê°’ì´ ì•„ë˜ë¡œ

plt.figure(figsize=(9, 6))
plt.hlines(y=growth_df.index, xmin=0, xmax=growth_df['íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ '], color='skyblue', lw=3)
plt.plot(growth_df['íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ '], growth_df.index, 'o', color='navy', markersize=10)

# plt.axvline(0, color='gray', linestyle='--', lw=1)
plt.xlabel('íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥ ', fontsize=13)
plt.title('í’ˆëª©êµ°ë³„ íŒ¬ë°ë¯¹ ì „í›„ ì„±ì¥ë¥  (Dot Plot)', fontsize=15)
plt.grid(axis='x', linestyle=':', alpha=0.7)
plt.tight_layout()
plt.show()
```

- ë‹¨ê¸°ì ìœ¼ë¡œ ê¸‰ì„±ì¥í•œ í’ˆëª©êµ°ì— ì£¼ëª© <br>
- íŒ¬ë°ë¯¹ ì´í›„ ì‹í’ˆ, ìë™ì°¨, ë†ì‚°ë¬¼ì€ ê±°ë˜ì•¡ì´ í¬ê²Œ ëŠ˜ì—ˆì§€ë§Œ ë³€ë™ì„±ì´ ì»¸ê³ , ì—¬í–‰Â·êµí†µì€ ê±°ë˜ì•¡ì´ ì¤„ì–´ë“¦ -->

---

## ë¶„ì„ (4) íŒ¬ë°ë¯¹ ìƒí™©ì—ì„œ ë³µí•© ì ìˆ˜ê°€ ë†’ì€ ìƒìœ„ í’ˆëª©êµ°

> ë¶„ì„: íŒ¬ë°ë¯¹ ì´í›„ í’ˆëª©êµ°ë³„ ë³µí•©ì ìˆ˜ ë¹„êµ

- ëª©ì : íŒ¬ë°ë¯¹ ì „í›„ ê° í’ˆëª©êµ°ì˜ ì„±ì¥ë¥ ê³¼ **ì•ˆì •ì„±(ë³€ë™ì„±)**ì„ ë™ì‹œì— ë°˜ì˜í•œ ë³µí•©ì ìˆ˜ ì‚°ì¶œ
- ì„±ì¥ë¥ : íŒ¬ë°ë¯¹ ì´í›„ í‰ê·  ê±°ë˜ì•¡ì´ ì–¼ë§ˆë‚˜ ì¦ê°€í–ˆëŠ”ì§€
- ì•ˆì •ì„±: íŒ¬ë°ë¯¹ ì´í›„ ê±°ë˜ì•¡ì˜ í‘œì¤€í¸ì°¨(ë³€ë™ì„±)
$$
\text{ë³µí•©ì ìˆ˜} = \frac{\text{ì„±ì¥ë¥ }}{\text{í‘œì¤€í¸ì°¨} + 1}
$$

- ì„±ì¥ë¥ ì´ ë†’ê³ , ë³€ë™ì„±ì´ ë‚®ì„ìˆ˜ë¡ ì ìˆ˜ê°€ ë†’ìŒ

```{python}
#| echo: false
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# === ì½”ë¡œë‚˜ ì „í›„ ê¸°ê°„ ì„¤ì • (2018-2019 vs 2020-2021) ===
pre_covid_start = pd.to_datetime('2018-01-01')
pre_covid_end = pd.to_datetime('2019-12-31')
post_covid_start = pd.to_datetime('2020-01-01')
post_covid_end = pd.to_datetime('2021-12-31')

# === ë¶„ì„ ëŒ€ìƒ í’ˆëª©êµ° ===
target_categories = ['Computer', 'Electronics', 'Automobiles', 'Clothing', 'E-Coupon Service']

# === ê° í’ˆëª©êµ°ì˜ ì›”ë³„ ê±°ë˜ì•¡ ë°ì´í„° ì¶”ì¶œ ===
category_data = {}
for category in target_categories:
    # í’ˆëª©êµ°ë³„ ë°ì´í„° ì¶”ì¶œ
    df_category = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    
    # ì½”ë¡œë‚˜ ì´ì „ ë°ì´í„° (2018-2019)
    pre_covid = df_category[(df_category['ë…„ì›”'] >= pre_covid_start) & (df_category['ë…„ì›”'] <= pre_covid_end)]
    
    # ì½”ë¡œë‚˜ ì´í›„ ë°ì´í„° (2020-2021)
    post_covid = df_category[(df_category['ë…„ì›”'] >= post_covid_start) & (df_category['ë…„ì›”'] <= post_covid_end)]

    # í‰ê·  ê±°ë˜ì•¡ ë° í‘œì¤€í¸ì°¨ ê³„ì‚°
    avg_pre = pre_covid['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean()
    avg_post = post_covid['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean()
    std_post = post_covid['ê±°ë˜ì•¡_ë°±ë§Œì›'].std()
    
    # ì„±ì¥ë¥  ë° ë³µí•© ì ìˆ˜ ê³„ì‚°
    growth_rate = (avg_post - avg_pre) / avg_pre
    composite_score = growth_rate / (std_post + 1)
    
    category_data[category] = composite_score

# === ë³µí•© ì ìˆ˜ ì •ë ¬ ë° ì‹œê°í™” ===
scores_df = pd.DataFrame.from_dict(category_data, orient='index', columns=['ë³µí•©ì ìˆ˜'])
scores_df = scores_df.sort_values(by='ë³µí•©ì ìˆ˜', ascending=False)

# ë³µí•©ì ìˆ˜ ë‹¨ìœ„ ë³€í™˜ (ë°±ë§Œ ë‹¨ìœ„)
SCALE = 1_000_000
scores_df['ë³µí•©ì ìˆ˜(ë°±ë§Œë‹¨ìœ„)'] = scores_df['ë³µí•©ì ìˆ˜'] * SCALE

# ìƒìœ„ 3ê°œ í’ˆëª©êµ° ì¬ì„¤ì • (ë³€í™˜ í›„ì—ë„ ë™ì¼)
top_3_categories = scores_df.sort_values(by='ë³µí•©ì ìˆ˜(ë°±ë§Œë‹¨ìœ„)', ascending=False).head(3).index.tolist()

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
colors = ['red' if cat in top_3_categories else 'gray' for cat in scores_df.index]
plt.bar(scores_df.index, scores_df['ë³µí•©ì ìˆ˜(ë°±ë§Œë‹¨ìœ„)'], color=colors)
plt.title('íŒ¬ë°ë¯¹ ìƒí™©ì—ì„œ ë³µí•© ì ìˆ˜ ìƒìœ„ í’ˆëª©êµ°', fontsize=16)
plt.xlabel('í’ˆëª©êµ°', fontsize=16)
plt.ylabel('ë³µí•©ì ìˆ˜ (Ã—1,000,000)', fontsize=12)
plt.xticks(rotation=45, ha='center', fontsize=15)
plt.grid(axis='y')
plt.tight_layout()
plt.show()
```

- ë³µí•©ì ìˆ˜(ì„±ì¥ë¥ +ì•ˆì •ì„±)ë¡œ ì¥ê¸°ì ìœ¼ë¡œ ì•ˆì •ì ì´ê³  ê¾¸ì¤€íˆ ì„±ì¥í•  í’ˆëª©êµ°ì— ì£¼ëª©

---

## ğŸ¯ ìœ ë§ í’ˆëª©êµ° ë³µí•©ì ìˆ˜ ìµœì¢… Top 3

| ìˆœìœ„ | í•­ëª©             | ë³µí•©ì ìˆ˜              |
|-----|-----------------|-----------------------|
|  ğŸ¥‡ |  Automobiles       | 13.516764        |
| ğŸ¥ˆ  |  E-Coupon Service    | 4.967626      |
| ğŸ¥‰  | Computer      | 3.183995 |





<h2 style="font-size: 20px; font-weight: bold; line-height: 1.3;">

## ì£¼ì œ 4. ëª¨ë°”ì¼ê³¼ ì¸í„°ë„·,<br> íŒë§¤ì±„ë„ì˜ ì‹œë„ˆì§€ê°€ ì œì¼ ì¢‹ì€ í’ˆëª©ì€?

</h2>

<blockquote style="font-size: 35px; font-style: italic; color: #555;">

"ì–´ë–¤ í’ˆëª©ì—ì„œ ì¸í„°ë„·ì‡¼í•‘ê³¼ ëª¨ë°”ì¼ì‡¼í•‘ì˜ ì‹œë„ˆì§€ê°€ ê°€ì¥ ì¢‹ì„ê¹Œ?"

</blockquote>

<br>

-   **ë¶„ì„ ë°©ë²•**: íŒë§¤ì±„ë„ ê°„ì˜ ê´€ê³„ íšŒê·€ë¶„ì„
-   **ëŒ€ìƒ í’ˆëª©**: Automobiles, E-Coupon Service, Computer

```{python}
#| echo: false

import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import statsmodels.formula.api as smf
import statsmodels.api as sm
from scipy.stats import shapiro
from statsmodels.stats.diagnostic import het_breuschpagan
from scipy import stats
```

```{python}
#| echo: true
#| eval: true
#| results: hide

# ëª¨ë°”ì¼ê³¼ ì¸í„°ë„· ë°ì´í„° ë³‘í•©
df_mobile = df_long[df_long['íŒë§¤ë§¤ì²´'] == 'Mobile'].copy()
df_internet = df_long[df_long['íŒë§¤ë§¤ì²´'] == 'Internet'].copy()
df_merged = pd.merge(
    df_mobile,
    df_internet,
    on=['ìƒí’ˆêµ°ì½”ë“œ', 'ë…„ì›”'],
    suffixes=('_mobile', '_internet')
)

# ì»¬ëŸ¼ëª… ë³€ê²½
df_merged.rename(columns={
    'ê±°ë˜ì•¡_ë°±ë§Œì›_mobile': 'Mobile',
    'ê±°ë˜ì•¡_ë°±ë§Œì›_internet': 'Internet'
}, inplace=True)

# ë¶„ì„ ëŒ€ìƒ í’ˆëª©ë§Œ ì„ íƒ (Automobiles, E-Coupon Service, Computer)
categories = ['Automobiles', 'E-Coupon Service', 'Computer']
df_selected = df_merged[df_merged['ìƒí’ˆêµ°ì½”ë“œ'].isin(categories)].copy()


```

------------------------------------------------------------------------

## ë¶„ì„ (1) íŒë§¤ì±„ë„ ê°„ì˜ ê´€ê³„ íšŒê·€ë¶„ì„

$$
\text{Mobile} = \beta_0 + \beta_1 \times \text{Internet} + \beta_2 \times D_1 + \beta_3 \times D_2 + \beta_4 \times (\text{Internet} \times D_1) + \beta_5 \times (\text{Internet} \times D_2) + \varepsilon
$$

> í’ˆëª©ì„ ë²”ì£¼í˜• ë”ë¯¸ë³€ìˆ˜(ê¸°ì¤€ ë²”ì£¼: Automobiles)ë¡œ ì‚¬ìš©í•˜ì—¬ ìƒí˜¸ì‘ìš© ì¶”ê°€ íšŒê·€ëª¨ë¸ ì„¤ì •

-   AutomobilesëŠ” ê¸°ì¤€ ë²”ì£¼, ë‘ ë”ë¯¸ë³€ìˆ˜ê°€ ëª¨ë‘ 0ì¸ ê²½ìš°
-   $D_1$: Computer ë²”ì£¼ì˜ ë”ë¯¸ ë³€ìˆ˜ (Computer=1, ê·¸ ì™¸=0)
-   $D_2$: E-Coupon Service ë²”ì£¼ì˜ ë”ë¯¸ ë³€ìˆ˜ <br>(E-Coupon Service=1, ê·¸ ì™¸=0)

------------------------------------------------------------------------

> ì´ë¥¼ í† ëŒ€ë¡œ ê° í’ˆëª©ë³„ íšŒê·€ì‹ì€ ë‹¤ìŒê³¼ ê°™ì´ í•´ì„:

-   Automobiles ê¸°ì¤€ $$
    \text{Mobile} = \beta_0 + \beta_1 \times \text{Internet} + \varepsilon
    $$

-   Computer ê¸°ì¤€ $$
    \text{Mobile} = (\beta_0 + \beta_2) + (\beta_1 + \beta_4) \times \text{Internet} + \varepsilon
    $$

-   E-Coupon Service ê¸°ì¤€ $$
    \text{Mobile} = (\beta_0 + \beta_3) + (\beta_1 + \beta_5) \times \text{Internet} +
    \varepsilon
    $$

------------------------------------------------------------------------

## íšŒê·€ë¶„ì„ ê²°ê³¼

<br>

::: panel-tabset
### ì½”ë“œ

```{python}
#| echo: true
#| eval: false
#| code-fold: false


# ì„¸ í’ˆëª©ì˜ ë°ì´í„°ë§Œ í•„í„°ë§í•˜ì—¬ í†µí•© ë°ì´í„°ì…‹ ìƒì„±
categories = ['Automobiles', 'E-Coupon Service', 'Computer']
df_unified = df_selected[df_selected['ìƒí’ˆêµ°ì½”ë“œ'].isin(categories)].copy()

# í†µí•© íšŒê·€ëª¨ë¸ ìƒì„±
model_unified = smf.ols(
    formula='Mobile ~ Internet * C(ìƒí’ˆêµ°ì½”ë“œ)', 
    data=df_unified
).fit()

print("[í†µí•© íšŒê·€ëª¨ë¸ ìš”ì•½]")
print(model_unified.summary())

# ì •ê·œì„± ê²€ì • (Shapiro-Wilk)
resid_unified = model_unified.resid
stat, p_value = shapiro(resid_unified)
print(f"\nShapiro-Wilk ì •ê·œì„± ê²€ì • p-value: {p_value:.4f}")
print(f"ì •ê·œì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if p_value > 0.05 else 'ë¶ˆë§Œì¡±'}")

# ë“±ë¶„ì‚°ì„± ê²€ì • (Breusch-Pagan)
bp_test_unified = het_breuschpagan(resid_unified, model_unified.model.exog)
print(f"Breusch-Pagan ë“±ë¶„ì‚°ì„± ê²€ì • p-value: {bp_test_unified[1]:.4f}")
print(f"ë“±ë¶„ì‚°ì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if bp_test_unified[1] > 0.05 else 'ë¶ˆë§Œì¡±'}")



```

### ê²°ê³¼

```{python}
#| echo: false

# ì„¸ í’ˆëª©ì˜ ë°ì´í„°ë§Œ í•„í„°ë§í•˜ì—¬ í†µí•© ë°ì´í„°ì…‹ ìƒì„±
categories = ['Automobiles', 'E-Coupon Service', 'Computer']
df_unified = df_selected[df_selected['ìƒí’ˆêµ°ì½”ë“œ'].isin(categories)].copy()

# í†µí•© íšŒê·€ëª¨ë¸ ìƒì„±
model_unified = smf.ols(
    formula='Mobile ~ Internet * C(ìƒí’ˆêµ°ì½”ë“œ)', 
    data=df_unified
).fit()


print("[í†µí•© íšŒê·€ëª¨ë¸ ìš”ì•½]")
print(model_unified.summary())

# ì •ê·œì„± ê²€ì • (Shapiro-Wilk)
resid_unified = model_unified.resid
stat, p_value = shapiro(resid_unified)
print(f"\nShapiro-Wilk ì •ê·œì„± ê²€ì • p-value: {p_value:.4f}")
print(f"ì •ê·œì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if p_value > 0.05 else 'ë¶ˆë§Œì¡±'}")

# ë“±ë¶„ì‚°ì„± ê²€ì • (Breusch-Pagan)
bp_test_unified = het_breuschpagan(resid_unified, model_unified.model.exog)
print(f"Breusch-Pagan ë“±ë¶„ì‚°ì„± ê²€ì • p-value: {bp_test_unified[1]:.4f}")
print(f"ë“±ë¶„ì‚°ì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if bp_test_unified[1] > 0.05 else 'ë¶ˆë§Œì¡±'}")

```
:::

------------------------------------------------------------------------

## íšŒê·€ëª¨ë¸ ë³´ì™„ì˜ í•„ìš”ì„±

<br>

> ì”ì°¨ì˜ ì •ê·œì„± ë° ë“±ë¶„ì‚°ì„± ê°€ì • ë¶ˆë§Œì¡±

> ë³´ì™„ì„ ìœ„í•œ ì ì ˆí•œ ì¡°ì¹˜ê°€ í•„ìš” -\> ì´ë¥¼ ìœ„í•œ **ë¡œê·¸ ë³€í™˜** ìˆ˜í–‰

------------------------------------------------------------------------

## ë¶„ì„ (2) ë¡œê·¸ ë³€í™˜ ì ìš© íšŒê·€ë¶„ì„

<br>

::: {style="font-size: 0.8em;"}
$$
\log(\text{Mobile}) = \beta_0 + \beta_1 \times \log(\text{Internet}) + \beta_2 \times D_1 + \beta_3 \times D_2 + \beta_4 \times (\log(\text{Internet}) \times D_1) + \beta_5 \times (\log(\text{Internet}) \times D_2) + \varepsilon
$$

> ë¡œê·¸ ë³€í™˜ í›„ ê¸°ìš¸ê¸° ê³„ìˆ˜ëŠ” íƒ„ë ¥ì„±(elasticity)ì„ ì˜ë¯¸

-   Automobiles(ê¸°ì¤€ ë²”ì£¼): íƒ„ë ¥ì„± = $\beta_1$
-   Computer: íƒ„ë ¥ì„± = $\beta_1 + \beta_4$
-   E-Coupon Service: íƒ„ë ¥ì„± = $\beta_1 + \beta_5$
:::

<br>

### íƒ„ë ¥ì„± í•´ì„ ì˜ˆì‹œ - Automobiles

+-----------------+----------------------------------------------------+
| íƒ„ë ¥ì„± ì¡°ê±´     | í•´ì„                                               |
+=================+====================================================+
| $\beta_1 > 1$   | ì¸í„°ë„·ì‡¼í•‘ 1% ì¦ê°€                                 |
|                 |                                                    |
|                 | â†’ Automobiles ëª¨ë°”ì¼ì‡¼í•‘ 1% ì´ìƒ ì¦ê°€              |
+-----------------+----------------------------------------------------+
| $\beta_1 = 1$   | ì¸í„°ë„·ì‡¼í•‘ 1% ì¦ê°€                                 |
|                 |                                                    |
|                 | â†’ Automobiles ëª¨ë°”ì¼ì‡¼í•‘ 1% ì¦ê°€                   |
+-----------------+----------------------------------------------------+
| $\beta_1 < 1$   | ì¸í„°ë„·ì‡¼í•‘ 1% ì¦ê°€                                 |
|                 |                                                    |
|                 | â†’ Automobiles ëª¨ë°”ì¼ì‡¼í•‘ 1% ë¯¸ë§Œ ì¦ê°€              |
+-----------------+----------------------------------------------------+

------------------------------------------------------------------------

## ë¡œê·¸ ë³€í™˜ íšŒê·€ë¶„ì„ ê²°ê³¼

::: panel-tabset
## ì½”ë“œ

```{python}
#| echo: true
#| eval: false
#| code-fold: false


# ë¡œê·¸ ë³€í™˜ ë³€ìˆ˜ ìƒì„±
df_unified['log_Mobile'] = np.log(df_automobile['Mobile'])
df_unified['log_Internet'] = np.log(df_automobile['Internet'])

# ë¡œê·¸-ë¡œê·¸ í†µí•© ëª¨ë¸
model_unified_log = smf.ols(
    formula='log_Mobile ~ log_Internet * C(ìƒí’ˆêµ°ì½”ë“œ)', 
    data=df_unified
).fit()

print("\n[í†µí•© ë¡œê·¸-ë¡œê·¸ íšŒê·€ëª¨ë¸ ìš”ì•½]")
print(model_unified_log.summary())

# ì •ê·œì„± ê²€ì • (Shapiro-Wilk)
resid_unified_log = model_unified_log.resid
stat, p_value_log = shapiro(resid_unified_log)
print(f"\nShapiro-Wilk ì •ê·œì„± ê²€ì • p-value: {p_value_log:.4f}")
print(f"ì •ê·œì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if p_value_log > 0.05 else 'ë¶ˆë§Œì¡±'}")

# ë“±ë¶„ì‚°ì„± ê²€ì • (Breusch-Pagan)
bp_test_unified_log = het_breuschpagan(resid_unified_log, model_unified_log.model.exog)
print(f"Breusch-Pagan ë“±ë¶„ì‚°ì„± ê²€ì • p-value: {bp_test_unified_log[1]:.4f}")
print(f"ë“±ë¶„ì‚°ì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if bp_test_unified_log[1] > 0.05 else 'ë¶ˆë§Œì¡±'}")

```

## ê²°ê³¼

```{python}
#| echo: false

# ë¡œê·¸ ë³€í™˜ ë³€ìˆ˜ ìƒì„± (ì•„ì§ ì—†ëŠ” ê²½ìš° ìƒì„±)
if 'log_Mobile' not in df_unified.columns:
    df_unified['log_Mobile'] = np.log(df_unified['Mobile'])
if 'log_Internet' not in df_unified.columns:
    df_unified['log_Internet'] = np.log(df_unified['Internet'])

# ë¡œê·¸-ë¡œê·¸ í†µí•© ëª¨ë¸
model_unified_log = smf.ols(
    formula='log_Mobile ~ log_Internet * C(ìƒí’ˆêµ°ì½”ë“œ)', 
    data=df_unified
).fit()

print("\n[í†µí•© ë¡œê·¸-ë¡œê·¸ íšŒê·€ëª¨ë¸ ìš”ì•½]")
print(model_unified_log.summary())

# ì •ê·œì„± ê²€ì • (Shapiro-Wilk)
resid_unified_log = model_unified_log.resid
stat, p_value_log = shapiro(resid_unified_log)
print(f"\nShapiro-Wilk ì •ê·œì„± ê²€ì • p-value: {p_value_log:.4f}")
print(f"ì •ê·œì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if p_value_log > 0.05 else 'ë¶ˆë§Œì¡±'}")

# ë“±ë¶„ì‚°ì„± ê²€ì • (Breusch-Pagan)
bp_test_unified_log = het_breuschpagan(resid_unified_log, model_unified_log.model.exog)
print(f"Breusch-Pagan ë“±ë¶„ì‚°ì„± ê²€ì • p-value: {bp_test_unified_log[1]:.4f}")
print(f"ë“±ë¶„ì‚°ì„± ë§Œì¡± ì—¬ë¶€: {'ë§Œì¡±' if bp_test_unified_log[1] > 0.05 else 'ë¶ˆë§Œì¡±'}")


```
:::

------------------------------------------------------------------------

## ì”ì°¨ì˜ ì •ê·œì„± ë° ë“±ë¶„ì‚°ì„± ê²€ì • ì‹œê°í™”

### ë¡œê·¸ë³€í™˜ Before vs After

<br>

```{python}
#| echo: false

# í’ˆëª©ë³„ë¡œ ìƒ‰ìƒ ë§¤í•‘
colors = {'Automobiles': 'blue', 'E-Coupon Service': 'green', 'Computer': 'orange'}

# ì”ì°¨ ë¶„ì„ ê·¸ë˜í”„ (Plotly ë²„ì „)
fitted_values = model_unified.fittedvalues
residuals = model_unified.resid

fig = make_subplots(rows=1, cols=2, subplot_titles=('ì”ì°¨ vs ì˜ˆì¸¡ê°’', 'ì”ì°¨ Q-Q í”Œë¡¯'))

# ê° í’ˆëª©ë³„ ì”ì°¨ í‘œì‹œ
for category in categories:
    # í•´ë‹¹ í’ˆëª© ì¸ë±ìŠ¤
    idx = df_unified[df_unified['ìƒí’ˆêµ°ì½”ë“œ'] == category].index
    
    # ì²« ë²ˆì§¸ ì„œë¸Œí”Œë¡¯: ì”ì°¨ vs ì˜ˆì¸¡ê°’
    fig.add_trace(
        go.Scatter(
            x=fitted_values[idx],
            y=residuals[idx],
            mode='markers',
            marker=dict(color=colors[category], opacity=0.7),
            name=f'{category} ì”ì°¨'
        ),
        row=1, col=1
    )

# ê¸°ì¤€ì„ (y=0) ì¶”ê°€
fig.add_shape(
    type="line",
    x0=min(fitted_values),
    y0=0,
    x1=max(fitted_values),
    y1=0,
    line=dict(color="red", width=2, dash="solid"),
    row=1, col=1
)

# ë‘ ë²ˆì§¸ ì„œë¸Œí”Œë¡¯: Q-Q í”Œë¡¯
(osm, osr), _ = stats.probplot(residuals)

fig.add_trace(
    go.Scatter(
        x=osm,
        y=osr,
        mode='markers',
        marker=dict(color='purple', opacity=0.7),
        name='Q-Q í”Œë¡¯',
        showlegend=True
    ),
    row=1, col=2
)

# Q-Q í”Œë¡¯ ì°¸ì¡°ì„  ì¶”ê°€
slope, intercept, _, _, _ = stats.linregress(osm, osr)
line_x = np.array([min(osm), max(osm)])
line_y = intercept + slope * line_x

fig.add_trace(
    go.Scatter(
        x=line_x,
        y=line_y,
        mode='lines',
        line=dict(color='red', width=2),
        name='ì°¸ì¡°ì„ '
    ),
    row=1, col=2
)

# ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig.update_layout(
    height=500,
    width=900,
    plot_bgcolor='rgba(240, 240, 240, 0.8)',
    legend=dict(
        orientation="h",
        yanchor="bottom",
        y=1.02,
        xanchor="right",
        x=1
    )
)

fig.update_xaxes(title_text="ì˜ˆì¸¡ê°’", row=1, col=1, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_yaxes(title_text="ì”ì°¨", row=1, col=1, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_xaxes(title_text="ì´ë¡ ì  ë¶„ìœ„ìˆ˜", row=1, col=2, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_yaxes(title_text="í‘œë³¸ ë¶„ìœ„ìˆ˜", row=1, col=2, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')

fig.show()


```

<br>

```{python}
#| echo: false

# ë¡œê·¸-ë¡œê·¸ ëª¨ë¸ ì”ì°¨ ë¶„ì„ ê·¸ë˜í”„
fitted_values_log = model_unified_log.fittedvalues
residuals_log = model_unified_log.resid

fig = make_subplots(rows=1, cols=2, subplot_titles=('ì”ì°¨ vs ì˜ˆì¸¡ê°’ (ë¡œê·¸-ë¡œê·¸ ëª¨ë¸)', 'ì”ì°¨ Q-Q í”Œë¡¯ (ë¡œê·¸-ë¡œê·¸ ëª¨ë¸)'))

# ê° í’ˆëª©ë³„ ì”ì°¨ í‘œì‹œ
for category in categories:
    # í•´ë‹¹ í’ˆëª© ì¸ë±ìŠ¤
    idx = df_unified[df_unified['ìƒí’ˆêµ°ì½”ë“œ'] == category].index
    
    # ì²« ë²ˆì§¸ ì„œë¸Œí”Œë¡¯: ì”ì°¨ vs ì˜ˆì¸¡ê°’
    fig.add_trace(
        go.Scatter(
            x=fitted_values_log[idx],
            y=residuals_log[idx],
            mode='markers',
            marker=dict(color=colors[category], opacity=0.7),
            name=f'{category} ì”ì°¨'
        ),
        row=1, col=1
    )

# ê¸°ì¤€ì„ (y=0) ì¶”ê°€
fig.add_shape(
    type="line",
    x0=min(fitted_values_log),
    y0=0,
    x1=max(fitted_values_log),
    y1=0,
    line=dict(color="red", width=2, dash="solid"),
    row=1, col=1
)

# ë‘ ë²ˆì§¸ ì„œë¸Œí”Œë¡¯: Q-Q í”Œë¡¯
(osm, osr), _ = stats.probplot(residuals_log)

fig.add_trace(
    go.Scatter(
        x=osm,
        y=osr,
        mode='markers',
        marker=dict(color='purple', opacity=0.7),
        name='Q-Q í”Œë¡¯',
        showlegend=True
    ),
    row=1, col=2
)

# Q-Q í”Œë¡¯ ì°¸ì¡°ì„  ì¶”ê°€
slope, intercept, _, _, _ = stats.linregress(osm, osr)
line_x = np.array([min(osm), max(osm)])
line_y = intercept + slope * line_x

fig.add_trace(
    go.Scatter(
        x=line_x,
        y=line_y,
        mode='lines',
        line=dict(color='red', width=2),
        name='ì°¸ì¡°ì„ '
    ),
    row=1, col=2
)

# ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig.update_layout(
    height=500,
    width=900,
    plot_bgcolor='rgba(240, 240, 240, 0.8)',
    legend=dict(
        orientation="h",
        yanchor="bottom",
        y=1.02,
        xanchor="right",
        x=1
    )
)

fig.update_xaxes(title_text="ì˜ˆì¸¡ê°’ (ë¡œê·¸ ë³€í™˜)", row=1, col=1, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_yaxes(title_text="ì”ì°¨", row=1, col=1, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_xaxes(title_text="ì´ë¡ ì  ë¶„ìœ„ìˆ˜", row=1, col=2, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')
fig.update_yaxes(title_text="í‘œë³¸ ë¶„ìœ„ìˆ˜", row=1, col=2, showgrid=True, gridwidth=1, gridcolor='rgba(211, 211, 211, 0.6)')

fig.show()
```

------------------------------------------------------------------------

## íšŒê·€ëª¨ë¸ ì‹œê°í™”

### ë¡œê·¸ë³€í™˜ Before vs After

<br>

::: panel-tabset
### Before

```{python}
#| echo: false

# í’ˆëª©ë³„ í†µí•© íšŒê·€ëª¨ë¸ ì‹œê°í™”
fig = go.Figure()

# ê° í’ˆëª©ë³„ ë°ì´í„°ì™€ íšŒê·€ì„  ì¶”ê°€
for category in categories:
    # í•´ë‹¹ í’ˆëª© ë°ì´í„° í•„í„°ë§
    df_cat = df_unified[df_unified['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    
    # ì‚°ì ë„ ì¶”ê°€
    fig.add_trace(
        go.Scatter(
            x=df_cat['Internet'],
            y=df_cat['Mobile'],
            mode='markers',
            name=f'{category} ë°ì´í„°',
            marker=dict(color=colors[category], size=10, opacity=0.7)
        )
    )
    
    # í•´ë‹¹ í’ˆëª©ì— ëŒ€í•œ ì˜ˆì¸¡ì„  ìƒì„±ì„ ìœ„í•œ X ê°’ ì¤€ë¹„
    x_range = np.linspace(df_cat['Internet'].min(), df_cat['Internet'].max(), 100)
    
    # í†µí•© ëª¨ë¸ì„ ì´ìš©í•œ ì˜ˆì¸¡ê°’ ê³„ì‚°ì„ ìœ„í•´ ê°€ìƒ ë°ì´í„°í”„ë ˆì„ ìƒì„±
    pred_df = pd.DataFrame({
        'Internet': x_range,
        'ìƒí’ˆêµ°ì½”ë“œ': category
    })
    
    # predict ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ê°’ ê³„ì‚°
    y_pred = model_unified.predict(pred_df)
    
    # íšŒê·€ì„  ì¶”ê°€
    fig.add_trace(
        go.Scatter(
            x=x_range,
            y=y_pred,
            mode='lines',
            name=f'{category} íšŒê·€ì„ ',
            line=dict(color=colors[category], width=2)
        )
    )

# ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig.update_layout(
    title='í’ˆëª©ë³„ ì¸í„°ë„·ì‡¼í•‘ vs ëª¨ë°”ì¼ì‡¼í•‘ ê±°ë˜ì•¡ (í†µí•© íšŒê·€ëª¨ë¸)',
    title_font_size=16,
    xaxis_title='ì¸í„°ë„·ì‡¼í•‘ ê±°ë˜ì•¡ (ë°±ë§Œì›)',
    yaxis_title='ëª¨ë°”ì¼ì‡¼í•‘ ê±°ë˜ì•¡ (ë°±ë§Œì›)',
    legend_title='ë²”ë¡€',
    plot_bgcolor='rgba(240, 240, 240, 0.8)',
    xaxis=dict(
        showgrid=True,
        gridwidth=1,
        gridcolor='rgba(211, 211, 211, 0.6)'
    ),
    yaxis=dict(
        showgrid=True,
        gridwidth=1,
        gridcolor='rgba(211, 211, 211, 0.6)'
    ),
    height=600,
    width=1000
)

fig.show()

```

### After

```{python}
#| echo: false

# ë¡œê·¸-ë¡œê·¸ ëª¨ë¸ì„ ì›ë³¸ ì²™ë„ë¡œ ë³€í™˜í•˜ì—¬ ì‹œê°í™”
fig = go.Figure()

# ê° í’ˆëª©ë³„ ì›ë³¸ ë°ì´í„°ì™€ ë³€í™˜ëœ íšŒê·€ì„  ì¶”ê°€
for category in categories:
    # í•´ë‹¹ í’ˆëª© ë°ì´í„° í•„í„°ë§
    df_cat = df_unified[df_unified['ìƒí’ˆêµ°ì½”ë“œ'] == category]
    
    # ì›ë³¸ ì‚°ì ë„ ì¶”ê°€
    fig.add_trace(
        go.Scatter(
            x=df_cat['Internet'],
            y=df_cat['Mobile'],
            mode='markers',
            name=f'{category} ì›ë³¸ ë°ì´í„°',
            marker=dict(color=colors[category], size=10, opacity=0.7)
        )
    )
    
    # í•´ë‹¹ í’ˆëª©ì— ëŒ€í•œ ì˜ˆì¸¡ì„ ìœ„í•œ X ê°’ ì¤€ë¹„ (ì›ë³¸ ì²™ë„)
    x_original = np.linspace(df_cat['Internet'].min(), df_cat['Internet'].max(), 100)
    
    # ë¡œê·¸ ë³€í™˜
    x_log = np.log(x_original)
    
    # í†µí•© ëª¨ë¸ì„ ì´ìš©í•œ ì˜ˆì¸¡ê°’ ê³„ì‚°ì„ ìœ„í•´ ê°€ìƒ ë°ì´í„°í”„ë ˆì„ ìƒì„±
    pred_df = pd.DataFrame({
        'log_Internet': x_log,
        'ìƒí’ˆêµ°ì½”ë“œ': category
    })
    
    # predict ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ ì²™ë„ì—ì„œì˜ ì˜ˆì¸¡ê°’ ê³„ì‚°
    y_log_pred = model_unified_log.predict(pred_df)
    
    # ì›ë³¸ ì²™ë„ë¡œ ë³€í™˜ (ì§€ìˆ˜ ë³€í™˜)
    y_pred_original = np.exp(y_log_pred)
    
    # ë³€í™˜ëœ íšŒê·€ì„  ì¶”ê°€
    fig.add_trace(
        go.Scatter(
            x=x_original,
            y=y_pred_original,
            mode='lines',
            name=f'{category} íšŒê·€ì„  (ë³€í™˜)',
            line=dict(color=colors[category], width=2)
        )
    )

# ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig.update_layout(
    title='í’ˆëª©ë³„ ì¸í„°ë„·ì‡¼í•‘ vs ëª¨ë°”ì¼ì‡¼í•‘ ê±°ë˜ì•¡ (ë¡œê·¸-ë¡œê·¸ ëª¨ë¸ ì›ë³¸ ì²™ë„ ë³€í™˜)',
    title_font_size=16,
    xaxis_title='ì¸í„°ë„·ì‡¼í•‘ ê±°ë˜ì•¡ (ë°±ë§Œì›)',
    yaxis_title='ëª¨ë°”ì¼ì‡¼í•‘ ê±°ë˜ì•¡ (ë°±ë§Œì›)',
    legend_title='ë²”ë¡€',
    plot_bgcolor='rgba(240, 240, 240, 0.8)',
    xaxis=dict(
        showgrid=True,
        gridwidth=1,
        gridcolor='rgba(211, 211, 211, 0.6)'
    ),
    yaxis=dict(
        showgrid=True,
        gridwidth=1,
        gridcolor='rgba(211, 211, 211, 0.6)'
    ),
    height=600,
    width=1000
)

fig.show()

```
:::

------------------------------------------------------------------------

## í’ˆëª©ë³„ ê¸°ìš¸ê¸°(íƒ„ë ¥ì„±) ë¹„êµ ì‹œê°í™”

```{python}
#| echo: false

# ëª¨ë¸ì—ì„œ ê¸°ìš¸ê¸° ê³„ìˆ˜ ì¶”ì¶œ
params = model_unified_log.params
base_category = sorted(df_unified['ìƒí’ˆêµ°ì½”ë“œ'].unique())[0]

# ê¸°ì¤€ ë²”ì£¼ì˜ ê¸°ìš¸ê¸°
base_slope = params['log_Internet']
print(f"\n{base_category}ì˜ ê¸°ìš¸ê¸°: {base_slope:.4f}")

# ë‹¤ë¥¸ í’ˆëª©ë“¤ì˜ ê¸°ìš¸ê¸°
for category in categories:
    if category != base_category:
        interaction_term = f"log_Internet:C(ìƒí’ˆêµ°ì½”ë“œ)[T.{category}]"
        if interaction_term in params:
            category_slope = base_slope + params[interaction_term]
            print(f"{category}ì˜ ê¸°ìš¸ê¸°: {category_slope:.4f}")

# í’ˆëª©ë³„ ê¸°ìš¸ê¸° ë¹„êµ ì‹œê°í™”
fig = go.Figure()

# ê¸°ìš¸ê¸° ë°ì´í„° ì¤€ë¹„
slopes = [base_slope]
slope_labels = [base_category]

# ë‹¤ë¥¸ í’ˆëª©ë“¤ì˜ ê¸°ìš¸ê¸° ê³„ì‚°
for category in categories:
    if category != base_category:
        interaction_term = f"log_Internet:C(ìƒí’ˆêµ°ì½”ë“œ)[T.{category}]"
        if interaction_term in params:
            category_slope = base_slope + params[interaction_term]
            slopes.append(category_slope)
            slope_labels.append(category)

# ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
fig.add_trace(go.Bar(
    x=slope_labels,
    y=slopes,
    text=[f"{s:.3f}" for s in slopes],
    textposition='outside',
    marker_color=[colors[cat] for cat in slope_labels],
    width=0.5
))

# ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ ì„¤ì •
fig.update_layout(
    title='ë¡œê·¸-ë¡œê·¸ ëª¨ë¸: í’ˆëª©ë³„ ê¸°ìš¸ê¸° ë¹„êµ (íƒ„ë ¥ì„±)',
    title_font_size=16,
    xaxis_title='ìƒí’ˆêµ°',
    yaxis_title='ê¸°ìš¸ê¸° (íƒ„ë ¥ì„±)',
    plot_bgcolor='rgba(240, 240, 240, 0.8)',
    xaxis=dict(
        showgrid=False,
    ),
    yaxis=dict(
        showgrid=True,
        gridwidth=1,
        gridcolor='rgba(211, 211, 211, 0.6)',
        zerolinecolor='black'
    ),
    height=500,
    width=800
)

fig.show()
```

------------------------------------------------------------------------

## ğŸ¯ ì£¼ì œ 4 ìµœì¢… ì„ íƒ í’ˆëª©

<br>

### ğŸ‘‘  Computer (ì»´í“¨í„° ë° ì£¼ë³€ê¸°ê¸°) 

> ê°€ì¥ ë†’ì€ íƒ„ë ¥ì„±ì„ ë³´ì—¬ <br> ì¸í„°ë„· ì‡¼í•‘ ì±„ë„ì˜ ì„±ì¥ì´ ëª¨ë°”ì¼ ì‡¼í•‘ ì±„ë„ì— <br> ê°•í•œ ê¸ì •ì  ì˜í–¥ì„ ì¤Œ

------------------------------------------------------------------------


## ì£¼ì œ 5. ìµœì¢… ì„ íƒ í’ˆëª©ì˜ ì›”ë³„ ê±°ë˜ëŸ‰ì€ ì–´ë–»ê²Œ ë ê¹Œ 


> "Computer í’ˆëª©ì˜ ì›”ë³„ ê±°ë˜ëŸ‰ì€ ì•ˆì •ì„±ì„ ëŒê¹Œ?"

-   **ë¶„ì„ ë°©ë²•**: anova, ì‚¬í›„ë¶„ì„
-   **ëŒ€ìƒ í’ˆëª©**: ì»´í“¨í„° 






-----------------------------------------------------------------------

## ë¶„ì„(1) Computer ì—°ë„ë³„ ì›”ë³„ ê±°ë˜ì•¡ ì¶”ì„¸

```{python}

#| echo: false

import plotly.express as px
import numpy as np
import calendar
from scipy.stats import shapiro, ttest_ind, wilcoxon, chi2_contingency,ttest_rel, f_oneway

```

```{python}

# Computer productsë§Œ í•„í„°ë§ (ëŒ€ì†Œë¬¸ì ë° ê³µë°± ì£¼ì˜: ì‹¤ì œ ë°ì´í„°ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤)
agri_df = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == 'Computer'].copy()

# ì—°ë„ì™€ ì›”ë³„ ê±°ë˜ì•¡ ì´í•© ê³„ì‚° í›„ ì •ë ¬
monthly_sum = agri_df.groupby(['ì—°ë„', 'ì›”'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].sum().reset_index()
monthly_sum = monthly_sum.sort_values(['ì—°ë„', 'ì›”'])

# ì—°ë„ ì»¬ëŸ¼ì„ ë¬¸ìì—´ë¡œ ë°”ê¿”ì•¼ ë²”ë¡€ì—ì„œ ì˜ ë‚˜ì˜µë‹ˆë‹¤.
monthly_sum['ì—°ë„_str'] = monthly_sum['ì—°ë„'].astype(str)

# Plotly Express ë¼ì¸ ì°¨íŠ¸
fig = px.line(
    monthly_sum,
    x='ì›”',
    y='ê±°ë˜ì•¡_ë°±ë§Œì›',
    color='ì—°ë„_str',
    markers=True,
    title='Monthly Transaction Trend: Computer Products (Plotly)',
    color_discrete_sequence=px.colors.sequential.Viridis
)

```

```{python}

#| echo: false

# xì¶• ëˆˆê¸ˆ ì›” ì´ë¦„ìœ¼ë¡œ ë°”ê¾¸ê¸°
fig.update_layout(
    xaxis=dict(
        title='Month',
        tickmode='array',
        tickvals=list(range(1,13)),
        ticktext=[calendar.month_abbr[m] for m in range(1,13)]
    ),
    yaxis=dict(title='Transaction Amount (â‚©100M)'),
    legend_title_text='Year',
    template='plotly_white'
)

fig.show()

```

ì—°ë„ë³„ ì›”ë³„ ê±°ë˜ì•¡ì´ ì¼ê´€ëœ íŒ¨í„´ì„ ìœ ì§€, í° ë“±ë½ ì—†ì´ ì•ˆì •ì ì¸ ìˆ˜ìš” í™•ì¸


------------------------------------------------------------------------

## Computer ì›”ë³„ í‰ê·  ê±°ë˜ì•¡ ë¹„êµ

```{python}

#| echo: false

# ì›” í‰ê·  ê·¸ë˜í”„ (ê° ì›”ì˜ í‰ê·  ê±°ë˜ì•¡)
monthly_avg = monthly_sum.groupby('ì›”')['ê±°ë˜ì•¡_ë°±ë§Œì›'].mean().reset_index()
monthly_avg = monthly_avg.sort_values('ì›”')

season_colors = ['#1f77b4', '#1f77b4', '#1f77b4',  # ê²¨ìš¸
                 '#2ca02c', '#2ca02c', '#2ca02c',  # ë´„
                 '#ff7f0e', '#ff7f0e', '#ff7f0e',  # ì—¬ë¦„
                 '#d62728', '#d62728', '#d62728']  # ê°€ì„


```

```{python}

# 'ì›”'ì„ ë¬¸ìì—´ë¡œ ë°”ê¿” ìˆœì„œ ë³´ì¥
monthly_avg['ì›”_str'] = monthly_avg['ì›”'].astype(str)

fig = px.bar(
    monthly_avg,
    x='ì›”_str',
    y='ê±°ë˜ì•¡_ë°±ë§Œì›',
    color='ì›”_str',
    color_discrete_sequence=season_colors,
    category_orders={'ì›”_str': [str(m) for m in range(1,13)]},
    title="ì›”ë³„ í‰ê·  ê±°ë˜ì•¡ (Season Highlight)"
)

fig.update_layout(
    xaxis_title="ì›”",
    yaxis_title="í‰ê·  ê±°ë˜ì•¡ (â‚©100M)",
    showlegend=False,
    template="plotly_white"
)

fig.update_xaxes(
    tickmode='array',
    tickvals=[str(m) for m in range(1,13)],
    ticktext=[calendar.month_abbr[m] for m in range(1,13)]
)

fig.show()

```

ê³„ì ˆì„± ì˜í–¥ ë¯¸ë¯¸, ì—°ì¤‘ ì•ˆì •ì  ìˆ˜ìš”

-------------------------------------------------------------------------

## ë¶„ì„(2) Computer ANOVA ë¶„ì„ ê²°ê³¼

```{python}

df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == 'Computer']
df_long['ì›”'] = df_long['ë…„ì›”'].dt.month

# # 1ì›”~12ì›” ê°ê°ì˜ ê±°ë˜ì•¡ ë¦¬ìŠ¤íŠ¸ë¡œ ë¶„ë¦¬
anova_groups = [df_long[df_long['ì›”'] == m]['ê±°ë˜ì•¡_ë°±ë§Œì›'] for m in range(1, 13)]

# ANOVA
f_stat, p_val = f_oneway(*anova_groups)
print(f"ğŸ“Š ANOVA ê²°ê³¼: F = {f_stat:.4f}, p = {p_val:.4e}")


df_long['ì›”'] = df_long['ë…„ì›”'].dt.month
total_df = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ'] == 'Computer']
monthly_values = total_df.groupby(['ë…„ì›”', 'ì›”'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].sum().reset_index()
anova_groups = [monthly_values[monthly_values['ì›”'] == m]['ê±°ë˜ì•¡_ë°±ë§Œì›'] for m in range(1, 13)]
f_stat, p_val = f_oneway(*anova_groups)
print(f"ğŸ“Š ANOVA ê²°ê³¼: F = {f_stat:.4f}, p = {p_val:.4e}")

# ì‚¬í›„ê²€ì •
# ì›” ì»¬ëŸ¼ì´ ë²”ì£¼í˜•ì´ë©´ ë” ì •í™•í•¨
monthly_values['ì›”'] = monthly_values['ì›”'].astype(str)  # ë˜ëŠ” category
from statsmodels.stats.multicomp import pairwise_tukeyhsd

# Tukey HSD ì‹¤í–‰
tukey_result = pairwise_tukeyhsd(
    endog=monthly_values['ê±°ë˜ì•¡_ë°±ë§Œì›'],   # yê°’ (ì—°ì†í˜•)
    groups=monthly_values['ì›”'],           # ê·¸ë£¹í•‘í•  ì¹´í…Œê³ ë¦¬ (ì›”)
    alpha=0.05                             # ìœ ì˜ìˆ˜ì¤€
)

```

```{python}

#| echo: false

# ê²°ê³¼ ì¶œë ¥
print(tukey_result)

tukey_result.plot_simultaneous(figsize=(12, 6))
plt.title("Tukey ì‚¬í›„ê²€ì •: ì›”ë³„ ê±°ë˜ì•¡ í‰ê·  ì°¨ì´")
plt.xlabel("ê±°ë˜ì•¡ ì°¨ì´ (ë°±ë§Œì›)")
plt.show()

```


-----------------------------------------------------------------------------------

## Tukey HSD ì‚¬í›„ê²€ì • ê²°ê³¼ ì‹œê°í™”

```{python}

#| echo: false

import plotly.express as px
import calendar


```

```{python}

# (í•„ìš”í•˜ë‹¤ë©´) ì›” ì»¬ëŸ¼ ì¬ìƒì„±
df_long['ì›”'] = df_long['ë…„ì›”'].dt.month

# Computer í’ˆëª©ë§Œ í•„í„°ë§, ì›”ë³„ í•©ê³„ ê³„ì‚°
comp_df = df_long[df_long['ìƒí’ˆêµ°ì½”ë“œ']=='Computer'].copy()
monthly_values = comp_df.groupby(['ë…„ì›”','ì›”'])['ê±°ë˜ì•¡_ë°±ë§Œì›'].sum().reset_index()

# ì›”ì„ ë¬¸ìì—´ë¡œ ë°”ê¿”ì„œ ìˆœì„œ ë³´ì¥
monthly_values['ì›”_str'] = monthly_values['ì›”'].astype(str)

# Plotly Express ë°•ìŠ¤í”Œë¡¯
fig = px.box(
    monthly_values,
    x='ì›”_str',
    y='ê±°ë˜ì•¡_ë°±ë§Œì›',
    color='ì›”_str',
    category_orders={'ì›”_str': [str(m) for m in range(1,13)]},
    color_discrete_sequence=season_colors,
    title="Computer í’ˆëª© ì›”ë³„ ê±°ë˜ì•¡ ë¶„í¬"
)

```

```{python}

#| echo: false
#| fig-width: 12    # ì¸ì¹˜ ë‹¨ìœ„
#| fig-height: 6
#| out-width: '100%' # ì…€ í­ì— ë§ì¶° ëŠ˜ë¦¬ê¸°
#| out-height: 'auto'

import matplotlib.pyplot as plt
# â€¦ ê¸°ì¡´ ë°•ìŠ¤í”Œë¡¯ ì½”ë“œ â€¦
plt.show()

# ê³„ì ˆë³„ ìƒ‰ìƒ (1â€“3ì›”: ê²¨ìš¸, 4â€“6ì›”: ë´„, 7â€“9ì›”: ì—¬ë¦„, 10â€“12ì›”: ê°€ì„)
season_colors = [
    '#1f77b4', '#1f77b4', '#1f77b4',  # ê²¨ìš¸
    '#2ca02c', '#2ca02c', '#2ca02c',  # ë´„
    '#ff7f0e', '#ff7f0e', '#ff7f0e',  # ì—¬ë¦„
    '#d62728', '#d62728', '#d62728'   # ê°€ì„
]

# ë ˆì´ì•„ì›ƒ ë° ì¶• ë¼ë²¨
fig.update_layout(
    xaxis_title="ì›”",
    yaxis_title="ê±°ë˜ì•¡ (ë°±ë§Œì›)",
    showlegend=False,
    template="plotly_white"
)

# xì¶• ëˆˆê¸ˆì„ Janâ€“Decë¡œ í‘œì‹œ
fig.update_xaxes(
    tickmode='array',
    tickvals=[str(m) for m in range(1,13)],
    ticktext=[calendar.month_abbr[m] for m in range(1,13)]
)


fig.show()

```

ì›”ë³„ ê±°ë˜ì•¡ ë¶„í¬ ì•ˆì •ì , ê³„ì ˆì  í¸ì°¨ ìµœì†Œ



------------------------------------------------------------------------

## ğŸ“¦ \[ìµœì¢… ì œì•ˆ\] ì°½ì—… ì¶”ì²œ í’ˆëª©: **Computer**

### ğŸ’¼ ì»¨ì„¤í„´íŠ¸ ì˜ê²¬ ìš”ì•½

-   âœ… **ì‹œì¥ì„±**: ìµœê·¼ 3ë…„ê°„ ê±°ë˜ì•¡ ê¾¸ì¤€í•œ ìƒìŠ¹ì„¸\
-   âœ… **ì•ˆì •ì„±**: ì—°ë„ë³„ ê±°ë˜ì•¡ ë³€ë™ì„± **ìµœì €** (ë¶„ì‚° 1ìœ„)\
-   âœ… **ì§€ì†ì„±**: ê³„ì ˆ/ì„±ìˆ˜ê¸° ì˜í–¥ ì—†ìŒ â†’ **ì—°ì¤‘ ìˆ˜ìš” ì•ˆì •**\
-   âœ… **ì±„ë„ ê°„ ì‹œë„ˆì§€**: ì¸í„°ë„· íŒë§¤ì™€ ëª¨ë°”ì¼ íŒë§¤ ê°„ ì˜í–¥ë ¥ì´ ê°€ì¥ í¬ê²Œ ë‚˜íƒ€ë‚¨

------------------------------------------------------------------------

## Q&A

> ê¶ê¸ˆí•˜ì‹  ì  ìˆìœ¼ì‹ ê°€ìš”?

------------------------------------------------------------------------